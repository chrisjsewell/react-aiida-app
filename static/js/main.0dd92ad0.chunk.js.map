{"version":3,"sources":["reportWebVitals.ts","clients/aiidaClient.ts","styles.ts","icons.tsx","pages.ts","PageHome.tsx","components/nodeTree.tsx","hooks.ts","PageNodeExplorer.tsx","components/provenanceGraph.tsx","PageProvenanceGraph.tsx","components/structureUtils.ts","components/structure3DViewer.tsx","components/structureTable.tsx","clients/optimadeClient.ts","components/structurePanel.tsx","components/optimadePanel.tsx","PageStructures.tsx","App.tsx","index.tsx"],"names":["reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","queryAiidaClient","QueryClient","defaultRestUrl","urlPattern","RegExp","uuidPattern","AiidaSettingsContext","React","createContext","baseUrl","a","fetch","response","ok","nodeType","page","perPage","nodeTypeQuery","totalCount","parseInt","headers","get","json","responseJson","nodes","data","getNode","uuid","test","TypeError","undefined","Object","values","repo_list","getNodeIncoming","incoming","getNodeOutgoing","outgoing","drawerWidth","useStyles","makeStyles","theme","createStyles","root","flexGrow","appBar","zIndex","drawer","transition","transitions","create","easing","sharp","duration","leavingScreen","appBarShift","marginLeft","width","enteringScreen","menuButton","marginRight","spacing","title","inputRestUrlIcon","inputRestUrl","minWidth","inputRestUrlText","color","hide","display","overflowAuto","overflow","flexShrink","whiteSpace","drawerOpen","drawerClose","overflowX","breakpoints","up","toolbar","alignItems","justifyContent","padding","mixins","mainGrid","paddingTop","paddingLeft","paddingRight","paper","palette","text","secondary","formControl","margin","InlineIcon","verticalAlign","padTop","pagination","paddingBottom","AiiDAIcon200","height","viewBox","xmlns","preserveAspectRatio","fill","id","y","x","transform","d","RocketIcon","SvgIcon","fillRule","GitBranchIcon","OptimadeIcon","version","y2","x2","y1","x1","style","stroke","strokeWidth","r","cy","cx","PageKeys","home","unknown","nodeExplorer","provenanceGraph","structures","PageHome","classes","Grid","container","className","item","xs","sm","md","Paper","variant","IntroBox","GettingStartedBox","DetailedBox","ExternalLink","href","props","target","rel","children","Alert","severity","language","type","tree","maxWidth","backgroundColor","background","refresh","listChip","marginBottom","float","nested1","nested2","initialMouseState","mouseX","mouseY","AiidaNodeTree","nodePrefix","useState","setPage","aiidaSettings","useContext","result","useQuery","getNodes","enabled","keepPreviousData","element","CircularProgress","pages","isIdle","icon","Math","ceil","isPreviousData","List","component","aria-label","map","value","AiidaTreeElement","pk","header","attributes","process_label","label","elementName","node_type","split","slice","join","info","mtime","process_type","tooltip","procLabel","procState","process_state","procExit","exit_status","isError","error","message","updateInfo","dataUpdatedAt","date","Date","toLocaleString","Button","startIcon","onClick","refetch","Pagination","disabled","count","onChange","event","ElementIconMap","default","folder","key","open","setOpen","contextPosition","setContextPosition","handleContextClose","preventDefault","stopPropagation","Tooltip","includes","Chip","Fragment","ListItem","button","onContextMenu","clientX","clientY","nested","ListItemAvatar","Avatar","ListItemText","primary","keepMounted","onClose","anchorReference","anchorPosition","top","left","MenuItem","copy","AiidaNodeChildren","nodeUUID","Divider","light","openRepo","setOpenRepo","openIncoming","setOpenIncoming","openOutgoing","setOpenOutgoing","Collapse","in","timeout","disablePadding","ListItemIcon","mountOnEnter","AiidaRepoList","AiidaLinkIncomingList","AiidaLinkOutgoingList","getNodeRepoList","name","link_type","toUpperCase","link_label","useLocalStorage","initialValue","window","localStorage","getItem","JSON","parse","console","log","storedValue","setStoredValue","valueToStore","setItem","stringify","PageNodeExplorer","setnodePrefix","nodeFieldsUUID","setnodeFieldsUUID","expandedTabs","setExpandedTabs","changeExpanded","tab","expanded","tabs","Set","add","delete","Array","from","direction","Accordion","defaultExpanded","AccordionSummary","expandIcon","AccordionDetails","NodeExplorerIntroduction","NodeExplorerFilters","NodeExplorerAttributes","nodePrefixesDefault","getNodeStatistics","nodePrefixes","types","total","FormControl","InputLabel","Select","labelId","entries","sort","view","src","collapseStringsAfterLength","isFetching","TextField","helperText","fullWidth","AiidaProvenanceGraph","dagMode","dagLevelDistance","fgRef","useRef","resultIncoming","resultOutgoing","useEffect","fg","current","d3Force","forceCollide","val","links","push","node","createNodeData","source","size","ref","graphData","nodeCanvasObject","linkDirectionalArrowLength","linkDirectionalArrowRelPos","pop","ctx","globalScale","fontSize","font","bckgDimensions","measureText","n","textAlign","textBaseline","strokeStyle","fillColor","fillStyle","fillRect","strokeRect","fillText","__bckgDimensions","PageProvenanceGraph","rootUUID","setrootUUID","setdagMode","setdagLevelDistance","ProvenanceGraphIntroduction","Typography","gutterBottom","Slider","defaultValue","aria-labelledby","valueLabelDisplay","step","marks","min","max","to","vectorLength","point","Vector3","length","toFixed","kinds2elMap","kinds","reduce","prev","symbols","element2colorThree","Color","atomData","XX","H","He","Li","Be","B","C","N","O","F","Ne","Na","Mg","Al","Si","P","S","Cl","Ar","K","Ca","Sc","Ti","V","Cr","Mn","Fe","Co","Ni","Cu","Zn","Ga","Ge","As","Se","Br","Kr","Rb","Sr","Y","Zr","Nb","Mo","Tc","Ru","Rh","Pd","Ag","Cd","In","Sn","Sb","Te","I","Xe","Cs","Ba","La","Ce","Pr","Nd","Pm","Sm","Eu","Gd","Tb","Dy","Ho","Er","Tm","Yb","Lu","Hf","Ta","W","Re","Os","Ir","Pt","Au","Hg","Tl","Pb","Bi","Po","At","Rn","Fr","Ra","Ac","Th","Pa","U","Np","Pu","Am","Structure3DViewer","OrbitControls","castShadow","position","Center","alignTop","Structure","images","withBox","cell","ax","ay","az","bx","by","bz","cz","sites","kindMap","boxes","na","nb","nc","newCell","BoundingBox","site","px","py","pz","Atom","radius","kind_name","mesh","args","transparent","opacity","v1","v2","z","Line","points","lineWidth","dashed","defaultProps","StructureTable","useTheme","columns","field","headerName","renderCell","params","g","b","element2colorCss","getContrastText","rows","index","kind","autoHeight","StructureURLs","cod","omdb","tcod","oqmd","odbx","formulaPattern","appendUrl","url","tail","replace","addCorsProxy","proxy","providersResponse2Map","providers","OptimadeClient","defaultProviders","versionPath","this","meta","api_version","charAt","getApiVersionPath","Promise","resolve","keys","providerId","filterFormula","exactFilter","pageLimit","urlBase","urlFull","filter","fields","origin","data_returned","structureId","query","representation","more_data_available","schema","data_available","description","base_url","homepage","StructurePanel","initTab","tabIndex","setTabIndex","Tabs","indicatorColor","textColor","Tab","TabPanel","StructurePanelAiiDA","StructurePanelOptimade","other","role","hidden","Box","p","uuidErrorMessage","StructurePanelBase","isLoading","provider","setProvider","setID","resultProviders","getStructureProviders","resultStructure","getStructureView","providerItems","pbc","dimension_types","nodeData","lattice_vectors","pbc1","pbc2","pbc3","cartesian_site_positions","i","species_at_sites","species","s","mass","chemical_symbols","weights","concentration","err","boundingBox","setboundingBox","aImages","setaImages","bImages","setbImages","cImages","setcImages","an","bn","cn","viewerSize","setviewerSize","viewerContainer","RepeatSlider","setter","marginTop","maxConstraints","offsetWidth","Infinity","resizeHandles","onResize","e","FormControlLabel","control","Checkbox","checked","labelPlacement","align","OptimadePanel","formulaFilter","setformulaFilter","setexactFilter","resultStructures","getStructures","items","Launch","tableElement","minHeight","OptimadeTable","Table","TableHead","TableRow","TableCell","TableBody","row","chemical_formula_descriptive","nsites","last_modified","PageStructures","ListItemLink","location","useLocation","renderLink","useMemo","forwardRef","itemProps","selected","pathname","App","showDevTools","setDrawerOpen","restUrlBase","setRestUrlBase","QueryClientProvider","client","AppBar","clsx","Toolbar","IconButton","edge","RestUrlConnection","autoComplete","InputProps","Drawer","Provider","exact","path","NotFound","initialIsOpen","isConnected","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.0dd92ad0.chunk.js","sourcesContent":["import { ReportHandler } from 'web-vitals'\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler): void => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry)\n      getFID(onPerfEntry)\n      getFCP(onPerfEntry)\n      getLCP(onPerfEntry)\n      getTTFB(onPerfEntry)\n    })\n  }\n}\n\nexport default reportWebVitals\n","import React from 'react'\nimport { QueryClient } from 'react-query'\n\nexport const queryAiidaClient = new QueryClient()\nexport const defaultRestUrl = 'http://127.0.0.1:5000/api/v4'\n// TODO move validation to aiidaClient functions?\nexport const urlPattern = new RegExp('^https?:\\\\/\\\\/[^\\\\?]+$')\nexport const uuidPattern = new RegExp('^[-a-zA-Z0-9]+$')\n\nexport const AiidaSettingsContext = React.createContext({\n  baseUrl: defaultRestUrl\n} as { baseUrl: null | string })\n\nexport interface IAiidaRestResponse {\n  // The base attributes for the rest response\n  data: any\n  id: null\n  method: 'GET' | 'POST'\n  path: string\n  query_string: string\n  resource_type: string\n  url: string\n  url_root: string\n}\n\nexport interface IAiidaRestNode {\n  ctime: string\n  full_type: string\n  id: number\n  label: string\n  mtime: string\n  node_type: string\n  process_type: string\n  user_id: number\n  uuid: string\n  attributes: { [key: string]: any }\n}\n\nexport interface IAiidaRestProcess extends IAiidaRestNode {\n  attributes: {\n    process_state:\n      | 'created'\n      | 'running'\n      | 'waiting'\n      | 'finished'\n      | 'excepted'\n      | 'killed'\n    process_label: string\n    exit_status: number\n  }\n}\n\nexport interface IAiidaRestResponseNode extends IAiidaRestResponse {\n  data: { nodes: IAiidaRestNode[] }\n}\n\nexport interface IAiidaRestNodeStatistics {\n  total: number\n  ctime_by_day: { [key: string]: number }\n  types: { [key: string]: number }\n}\n\nexport interface IAiidaRestResponseNodeStatistics extends IAiidaRestResponse {\n  data: IAiidaRestNodeStatistics\n}\n\nexport async function isConnected(baseUrl: string | null): Promise<boolean> {\n  if (baseUrl === null) {\n    return false\n  }\n  const response = await fetch(`${baseUrl}`)\n  return response.ok\n}\n\nexport async function getNodes(\n  baseUrl: string | null,\n  nodeType: string,\n  page: number\n): Promise<null | {\n  nodes: IAiidaRestNode[]\n  totalCount: number\n  perPage: number\n}> {\n  if (baseUrl === null) {\n    return null\n  }\n  const perPage = 20\n  const nodeTypeQuery = nodeType ? `node_type=like=%22${nodeType}%%22&` : ''\n  // TODO better url join?\n  const response = await fetch(\n    `${baseUrl}/nodes/page/${page}?perpage=${perPage}&orderby=-mtime&${nodeTypeQuery}attributes=true&attributes_filter=process_label,process_state,exit_status`\n  )\n  // TODO handle errors\n  const totalCount = parseInt(response.headers.get('x-total-count') || '0')\n  const responseJson = (await response.json()) as IAiidaRestResponseNode\n  return { nodes: responseJson.data.nodes, totalCount, perPage }\n}\n\nexport async function getNodeStatistics(\n  baseUrl: string | null\n): Promise<null | IAiidaRestNodeStatistics> {\n  if (baseUrl === null) {\n    return null\n  }\n  const response = await fetch(`${baseUrl}/nodes/statistics/`)\n  const responseJson = (await response.json()) as IAiidaRestResponseNodeStatistics\n  return responseJson.data\n}\n\nexport async function getNode(\n  baseUrl: string | null,\n  uuid: string | null\n): Promise<null | IAiidaRestNode> {\n  if (baseUrl === null || !uuid) {\n    return null\n  }\n  if (!uuidPattern.test(uuid)) {\n    throw new TypeError('UUID does not match required format')\n  }\n  const response = await fetch(`${baseUrl}/nodes/${uuid}?attributes=true&extras=true`)\n  const responseJson = (await response.json()) as IAiidaRestResponse\n  return responseJson.data?.nodes === undefined\n    ? null\n    : (Object.values(responseJson.data?.nodes)[0] as IAiidaRestNode)\n}\n\nexport interface IAiidaRestNodeRepoListItem {\n  name: string\n  type: 'FILE' | 'DIRECTORY'\n}\n\nexport interface IAiidaRestResponseNodeRepoList extends IAiidaRestResponse {\n  data: { repo_list: { [key: number]: IAiidaRestNodeRepoListItem } }\n}\n\nexport async function getNodeRepoList(\n  baseUrl: string | null,\n  uuid: string | null\n): Promise<null | IAiidaRestNodeRepoListItem[]> {\n  if (baseUrl === null || !uuid) {\n    return null\n  }\n  if (!uuidPattern.test(uuid)) {\n    throw new TypeError('UUID does not match required format')\n  }\n  const response = await fetch(`${baseUrl}/nodes/${uuid}/repo/list`)\n  const responseJson = (await response.json()) as IAiidaRestResponseNodeRepoList\n  return responseJson.data?.repo_list === undefined\n    ? null\n    : (Object.values(responseJson.data?.repo_list) as IAiidaRestNodeRepoListItem[])\n}\n\nexport interface IAiidaRestNodeLinkItem {\n  ctime: string\n  full_type: string\n  id: number\n  label: string\n  mtime: string\n  node_type: string\n  process_type: string\n  user_id: number\n  uuid: string\n  link_label: string\n  link_type: string\n}\n\nexport interface IAiidaRestResponseNodeIncoming extends IAiidaRestResponse {\n  data: { incoming: { [key: number]: IAiidaRestNodeLinkItem } }\n}\n\nexport async function getNodeIncoming(\n  baseUrl: string | null,\n  uuid: string | null\n): Promise<null | IAiidaRestNodeLinkItem[]> {\n  if (baseUrl === null || !uuid) {\n    return null\n  }\n  if (!uuidPattern.test(uuid)) {\n    throw new TypeError('UUID does not match required format')\n  }\n  // TODO deal with pagination\n  const response = await fetch(`${baseUrl}/nodes/${uuid}/links/incoming/page/1`)\n  const responseJson = (await response.json()) as IAiidaRestResponseNodeIncoming\n  return responseJson.data?.incoming === undefined\n    ? null\n    : (Object.values(responseJson.data?.incoming) as IAiidaRestNodeLinkItem[])\n}\n\nexport interface IAiidaRestResponseNodeOutgoing extends IAiidaRestResponse {\n  data: { outgoing: { [key: number]: IAiidaRestNodeLinkItem } }\n}\n\nexport async function getNodeOutgoing(\n  baseUrl: string | null,\n  uuid: string | null\n): Promise<null | IAiidaRestNodeLinkItem[]> {\n  if (baseUrl === null || !uuid) {\n    return null\n  }\n  if (!uuidPattern.test(uuid)) {\n    throw new TypeError('UUID does not match required format')\n  }\n  // TODO deal with pagination\n  const response = await fetch(`${baseUrl}/nodes/${uuid}/links/outgoing/page/1`)\n  const responseJson = (await response.json()) as IAiidaRestResponseNodeOutgoing\n  return responseJson.data?.outgoing === undefined\n    ? null\n    : (Object.values(responseJson.data?.outgoing) as IAiidaRestNodeLinkItem[])\n}\n","import { makeStyles, createStyles, Theme } from '@material-ui/core/styles'\n\nconst drawerWidth = 240\n\n// TODO use a spacer component instead of margins etc\n\nexport const useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      flexGrow: 1\n    },\n    appBar: {\n      zIndex: theme.zIndex.drawer + 1,\n      transition: theme.transitions.create(['width', 'margin'], {\n        easing: theme.transitions.easing.sharp,\n        duration: theme.transitions.duration.leavingScreen\n      })\n    },\n    appBarShift: {\n      marginLeft: drawerWidth,\n      width: `calc(100% - ${drawerWidth}px)`,\n      transition: theme.transitions.create(['width', 'margin'], {\n        easing: theme.transitions.easing.sharp,\n        duration: theme.transitions.duration.enteringScreen\n      })\n    },\n    menuButton: {\n      marginRight: theme.spacing(2)\n    },\n    title: {\n      flexGrow: 1\n    },\n    inputRestUrlIcon: {\n      marginRight: theme.spacing(1)\n    },\n    inputRestUrl: {\n      marginRight: theme.spacing(2),\n      minWidth: 200\n    },\n    inputRestUrlText: {\n      color: 'white'\n    },\n    hide: {\n      display: 'none'\n    },\n    overflowAuto: {\n      overflow: 'auto'\n    },\n    drawer: {\n      width: drawerWidth,\n      flexShrink: 0,\n      whiteSpace: 'nowrap'\n    },\n    drawerOpen: {\n      width: drawerWidth,\n      transition: theme.transitions.create('width', {\n        easing: theme.transitions.easing.sharp,\n        duration: theme.transitions.duration.enteringScreen\n      })\n    },\n    drawerClose: {\n      transition: theme.transitions.create('width', {\n        easing: theme.transitions.easing.sharp,\n        duration: theme.transitions.duration.leavingScreen\n      }),\n      overflowX: 'hidden',\n      width: theme.spacing(7) + 1,\n      [theme.breakpoints.up('sm')]: {\n        width: theme.spacing(9) + 1\n      }\n    },\n    toolbar: {\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'flex-end',\n      padding: theme.spacing(0, 1),\n      // necessary for content to be below app bar\n      ...theme.mixins.toolbar\n    },\n    mainGrid: {\n      paddingTop: theme.spacing(1),\n      paddingLeft: theme.spacing(10),\n      paddingRight: theme.spacing(10)\n    },\n    paper: {\n      padding: theme.spacing(2),\n      color: theme.palette.text.secondary\n    },\n    formControl: {\n      margin: theme.spacing(1),\n      minWidth: 200\n    },\n    InlineIcon: {\n      verticalAlign: 'middle',\n      display: 'inline-flex'\n    },\n    padTop: {\n      paddingTop: theme.spacing(2)\n    },\n    pagination: {\n      paddingTop: theme.spacing(2),\n      paddingBottom: theme.spacing(1)\n    }\n  })\n)\n","// From https://primer.style/octicons\n\nimport SvgIcon from '@material-ui/core/SvgIcon'\n\nexport function AiiDAIcon200({\n  width = 200,\n  height = 200\n}: {\n  width: number\n  height: number\n}): JSX.Element {\n  return (\n    <svg\n      width={width}\n      height={height}\n      viewBox=\"0 0 200 200\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      preserveAspectRatio=\"xMidYMid meet\"\n    >\n      {/* <!-- created using https://editor.method.ac --> */}\n      <g>\n        <title>background</title>\n        <rect\n          fill=\"none\"\n          id=\"canvas_background\"\n          height=\"402\"\n          width=\"582\"\n          y=\"-1\"\n          x=\"-1\"\n        />\n      </g>\n      <g>\n        <title>Layer 1</title>\n        <g id=\"svg_1\" fill=\"#000000\" transform=\"translate(0, 200) scale(0.1, -0.1)\">\n          <path\n            fill=\"#84D3DB\"\n            id=\"svg_2\"\n            d=\"m1369.99536,994.72168c-75,-21.00024 -101,-34.00024 -161,-80.00024c-68,-51.99976 -135,-150.99976 -153,-222.99976l-6,-28l150,0l150,0l0,60c0,33 4,60 9,60c5,0 43,-20 85,-45c42,-24 106,-61 143,-81c81,-45.00006 143,-83.00006 143,-88.00006c0,-3 -24,-18 -52,-33c-71,-39 -116,-65 -225,-129c-51,-30 -94,-54 -97,-54c-3,0 -6,29 -6,65l0,65l-151,0c-166,0 -152,6 -133,-61c14,-50 82,-144.99988 135,-188.99988c87,-72 151,-94 279,-95c88,0 115,4 163,23c119,48 224,165.99988 261,290.99988c30,102 13,250.00006 -36,323.00006c-10,14 -18,31 -18,36c0,16 -127,129.99976 -168,150.99976c-49,24 -158,51.00024 -208,50.00024c-21,0 -68,-8 -104,-18z\"\n          />\n        </g>\n        <g\n          id=\"svg_4\"\n          fill=\"#000000\"\n          transform=\"rotate(-120, 96.4437, 55.2508) translate(0, 200) scale(0.1, -0.1)\"\n        >\n          <path\n            fill=\"#FFB27C\"\n            id=\"svg_3\"\n            d=\"m849.99731,1866.47681c-75,-21 -101,-34 -161,-80c-68,-52 -135,-150.99988 -153,-222.99988l-6,-28l150,0l150,0l0,60c0,33 4,59.99988 9,59.99988c5,0 43,-19.99988 85,-44.99988c42,-24 105.99805,-61 142.99805,-81c81,-45 143,-83 143,-88c0,-3 -24,-18 -52,-33c-71,-39 -116,-65 -224.99805,-129c-51,-30 -94,-54 -97,-54c-3,0 -6,29 -6,65l0,65l-151,0c-166,0 -152,6 -133,-61c14,-50 82,-145 135,-189c87,-72 151,-93.99939 279,-94.99939c87.99805,0 114.99805,4 162.99805,22.99939c119,48 224,166 261,291c30,102 13,250 -36,322.99988c-10,14 -18,31 -18,36c0,16 -127,130 -168,151c-49,24 -158,51 -207.99805,50c-21,0 -68,-8 -104,-18z\"\n          />\n        </g>\n        <g\n          id=\"svg_6\"\n          fill=\"#000000\"\n          transform=\"rotate(120, 50.1463, 142.426) translate(0, 200) scale(0.1, -0.1)\"\n        >\n          <path\n            fill=\"#A0D58A\"\n            id=\"svg_5\"\n            d=\"m387.00516,994.72168c-75,-21.00024 -101,-34.00024 -161,-80.00024c-68,-51.99976 -135,-150.99976 -153,-222.99976l-6,-28l150,0l150,0l0,60c0,33 4,60 9,60c5,0 43,-20 85,-45c42,-24 105.99997,-61 142.99997,-81c81,-45.00006 143,-83.00006 143,-88.00006c0,-3 -24,-18 -52,-33c-71,-39 -116,-65 -224.99997,-129c-51,-30 -94,-54 -97,-54c-3,0 -6,29 -6,65l0,65l-151,0c-166,0 -152,6 -133,-61c14,-50 82,-144.99988 135,-188.99988c87,-72 151,-94 279,-95c87.99997,0 114.99997,4 162.99997,23c119,48 224,165.99988 261,290.99988c30,102 13,250.00006 -36,323.00006c-10,14 -18,31 -18,36c0,16 -127,129.99976 -168,150.99976c-49,24 -158,51.00024 -207.99997,50.00024c-21,0 -68,-8 -104,-18z\"\n          />\n        </g>\n      </g>\n    </svg>\n  )\n}\n\nexport function RocketIcon(): JSX.Element {\n  return (\n    <SvgIcon>\n      <path\n        fillRule=\"evenodd\"\n        d=\"M20.322.75a10.75 10.75 0 00-7.373 2.926l-1.304 1.23A23.743 23.743 0 0010.103 6.5H5.066a1.75 1.75 0 00-1.5.85l-2.71 4.514a.75.75 0 00.49 1.12l4.571.963c.039.049.082.096.129.14L8.04 15.96l1.872 1.994c.044.047.091.09.14.129l.963 4.572a.75.75 0 001.12.488l4.514-2.709a1.75 1.75 0 00.85-1.5v-5.038a23.741 23.741 0 001.596-1.542l1.228-1.304a10.75 10.75 0 002.925-7.374V2.499A1.75 1.75 0 0021.498.75h-1.177zM16 15.112c-.333.248-.672.487-1.018.718l-3.393 2.262.678 3.223 3.612-2.167a.25.25 0 00.121-.214v-3.822zm-10.092-2.7L8.17 9.017c.23-.346.47-.685.717-1.017H5.066a.25.25 0 00-.214.121l-2.167 3.612 3.223.679zm8.07-7.644a9.25 9.25 0 016.344-2.518h1.177a.25.25 0 01.25.25v1.176a9.25 9.25 0 01-2.517 6.346l-1.228 1.303a22.248 22.248 0 01-3.854 3.257l-3.288 2.192-1.743-1.858a.764.764 0 00-.034-.034l-1.859-1.744 2.193-3.29a22.248 22.248 0 013.255-3.851l1.304-1.23zM17.5 8a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zm-11 13c.9-.9.9-2.6 0-3.5-.9-.9-2.6-.9-3.5 0-1.209 1.209-1.445 3.901-1.49 4.743a.232.232 0 00.247.247c.842-.045 3.534-.281 4.743-1.49z\"\n      ></path>\n    </SvgIcon>\n  )\n}\n\nexport function GitBranchIcon(): JSX.Element {\n  return (\n    <SvgIcon>\n      <path\n        fillRule=\"evenodd\"\n        d=\"M5.75 21a1.75 1.75 0 110-3.5 1.75 1.75 0 010 3.5zM2.5 19.25a3.25 3.25 0 106.5 0 3.25 3.25 0 00-6.5 0zM5.75 6.5a1.75 1.75 0 110-3.5 1.75 1.75 0 010 3.5zM2.5 4.75a3.25 3.25 0 106.5 0 3.25 3.25 0 00-6.5 0zM18.25 6.5a1.75 1.75 0 110-3.5 1.75 1.75 0 010 3.5zM15 4.75a3.25 3.25 0 106.5 0 3.25 3.25 0 00-6.5 0z\"\n      ></path>\n      <path\n        fillRule=\"evenodd\"\n        d=\"M5.75 16.75A.75.75 0 006.5 16V8A.75.75 0 005 8v8c0 .414.336.75.75.75z\"\n      ></path>\n      <path\n        fillRule=\"evenodd\"\n        d=\"M17.5 8.75v-1H19v1a3.75 3.75 0 01-3.75 3.75h-7a1.75 1.75 0 00-1.75 1.75H5A3.25 3.25 0 018.25 11h7a2.25 2.25 0 002.25-2.25z\"\n      ></path>\n    </SvgIcon>\n  )\n}\n\nexport function OptimadeIcon({\n  width = 180,\n  height = 180\n}: {\n  width?: number\n  height?: number\n}): JSX.Element {\n  return (\n    <SvgIcon>\n      <svg\n        version=\"1\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        viewBox=\"0 0 400 400\"\n        width={width}\n        height={height}\n      >\n        <g\n        // transform=\"matrix(3.5294118,0,0,3.5294118,-5.2941176,-5.2938861)\"\n        >\n          <line\n            y2=\"7.9474411\"\n            x2=\"38\"\n            y1=\"14.5\"\n            x1=\"27\"\n            style={{ stroke: '#9ed700', strokeWidth: 1.14999998 }}\n          />\n          <line\n            y2=\"46.052559\"\n            x2=\"38\"\n            y1=\"33.25\"\n            x1=\"37.825317\"\n            style={{ stroke: '#00acd9', strokeWidth: 1.14999998 }}\n          />\n          <line\n            y2=\"27\"\n            x2=\"5\"\n            y1=\"33.25\"\n            x1=\"16.174683\"\n            style={{ stroke: '#7a2dd0', strokeWidth: 1.14999998 }}\n          />\n          <line\n            y2=\"46.052559\"\n            x2=\"38\"\n            y1=\"27\"\n            x1=\"49\"\n            style={{ stroke: '#00acd9', strokeWidth: 1.14999998 }}\n          />\n          <line\n            y2=\"46.052559\"\n            x2=\"16\"\n            y1=\"46.052559\"\n            x1=\"38\"\n            style={{ stroke: '#e8e8e8', strokeWidth: 2 }}\n          />\n          <line\n            y2=\"27\"\n            x2=\"5\"\n            y1=\"46.052559\"\n            x1=\"16\"\n            style={{ stroke: '#7a2dd0', strokeWidth: 1.14999998 }}\n          />\n          <line\n            y2=\"7.9474411\"\n            x2=\"16\"\n            y1=\"27\"\n            x1=\"5\"\n            style={{ stroke: '#e8e8e8', strokeWidth: 2 }}\n          />\n          <line\n            y2=\"7.9474411\"\n            x2=\"38\"\n            y1=\"7.9474411\"\n            x1=\"16\"\n            style={{ stroke: '#9ed700', strokeWidth: 1.14999998 }}\n          />\n          <line\n            y2=\"27\"\n            x2=\"49\"\n            y1=\"7.9474411\"\n            x1=\"38\"\n            style={{ stroke: '#e8e8e8', strokeWidth: 2 }}\n          />\n          <circle r=\"3.5\" cy=\"27\" cx=\"49\" style={{ fill: '#00acd9' }} />\n          <circle r=\"3.5\" cy=\"46.052559\" cx=\"38\" style={{ fill: '#00acd9' }} />\n          <circle\n            id=\"circle367\"\n            r=\"3.5\"\n            cy=\"46.052559\"\n            cx=\"16\"\n            style={{ fill: '#7a2dd0' }}\n          />\n          <circle r=\"3.5\" cy=\"27\" cx=\"5\" style={{ fill: '#7a2dd0' }} />\n          <circle r=\"3.5\" cy=\"7.9474411\" cx=\"16\" style={{ fill: '#9ed700' }} />\n          <circle r=\"3.5\" cy=\"7.9474411\" cx=\"38\" style={{ fill: '#9ed700' }} />\n          <line\n            y2=\"33.25\"\n            x2=\"16.174683\"\n            y1=\"39.5\"\n            x1=\"27\"\n            style={{ stroke: '#ff414d', strokeWidth: 1 }}\n          />\n          <line\n            y2=\"20.75\"\n            x2=\"16.174683\"\n            y1=\"33.25\"\n            x1=\"16.174683\"\n            style={{ stroke: '#ff414d', strokeWidth: 1 }}\n          />\n          <line\n            y2=\"14.5\"\n            x2=\"27\"\n            y1=\"20.75\"\n            x1=\"16.174683\"\n            style={{ stroke: '#ff414d', strokeWidth: 1 }}\n          />\n          <line\n            y2=\"20.75\"\n            x2=\"37.825317\"\n            y1=\"14.5\"\n            x1=\"27\"\n            style={{ stroke: '#ff414d', strokeWidth: 1 }}\n          />\n          <line\n            y2=\"33.25\"\n            x2=\"37.825317\"\n            y1=\"20.75\"\n            x1=\"37.825317\"\n            style={{ stroke: '#ff414d', strokeWidth: 1 }}\n          />\n          <line\n            y2=\"39.5\"\n            x2=\"27\"\n            y1=\"33.25\"\n            x1=\"37.825317\"\n            style={{ stroke: '#ff414d', strokeWidth: 1 }}\n          />\n          <circle r=\"2.5\" cy=\"39.5\" cx=\"27\" style={{ fill: '#ff414d' }} />\n          <circle r=\"2.5\" cy=\"33.25\" cx=\"16.174683\" style={{ fill: '#ff414d' }} />\n          <circle r=\"2.5\" cy=\"20.75\" cx=\"16.174683\" style={{ fill: '#ff414d' }} />\n          <circle r=\"2.5\" cy=\"14.5\" cx=\"27\" style={{ fill: '#ff414d' }} />\n          <circle r=\"2.5\" cy=\"20.75\" cx=\"37.825317\" style={{ fill: '#ff414d' }} />\n          <circle r=\"2.5\" cy=\"33.25\" cx=\"37.825317\" style={{ fill: '#ff414d' }} />\n        </g>\n      </svg>\n    </SvgIcon>\n  )\n}\n","export const PageKeys = {\n  home: '/',\n  unknown: '/404',\n  nodeExplorer: '/nodes',\n  provenanceGraph: '/graph',\n  structures: '/structures'\n}\n\nexport default PageKeys\n","import React from 'react'\nimport Grid from '@material-ui/core/Grid'\nimport Paper from '@material-ui/core/Paper'\nimport * as MuiIcons from '@material-ui/icons'\nimport Alert from '@material-ui/lab/Alert'\n\nimport SyntaxHighlighter from 'react-syntax-highlighter'\n\nimport { useStyles } from './styles'\n\nexport function PageHome(): JSX.Element {\n  const classes = useStyles()\n  return (\n    <Grid container spacing={2} className={classes.mainGrid}>\n      <Grid item xs={12} sm={12} md={6}>\n        <Paper variant=\"outlined\" className={classes.paper}>\n          <IntroBox />\n        </Paper>\n      </Grid>\n      <Grid item xs={12} sm={12} md={6}>\n        <Paper variant=\"outlined\" className={classes.paper}>\n          <GettingStartedBox />\n        </Paper>\n      </Grid>\n      <Grid item xs={12} sm={12} md={12}>\n        <Paper variant=\"outlined\" className={classes.paper}>\n          <DetailedBox />\n        </Paper>\n      </Grid>\n    </Grid>\n  )\n}\n\nexport function IntroBox(): JSX.Element {\n  return (\n    <div>\n      <h2>Introduction</h2>\n      <p>\n        This is a demonstration of the AiiDA Dashboard:\n        <br />A web-based UI for interfacing with AiiDA, that can also act as an\n        extension for JupyterLab.\n      </p>\n      <p>\n        AiiDA Dashboard uses industry leading libraries, to create a beautiful and\n        responsive UI:\n      </p>\n      <ul>\n        <li>\n          <ExternalLink href=\"https://reactjs.org/\">React</ExternalLink>: A library for\n          building user interfaces, maintained by Facebook and with users including\n          Whatsapp, Dropbox, Uber and Netflix.\n        </li>\n        <li>\n          <ExternalLink href=\"https://material-ui.com\">Material-UI</ExternalLink>: A\n          React component library that implements{' '}\n          <ExternalLink href=\"https://material.io/design\">\n            Google’s Material Design\n          </ExternalLink>{' '}\n          guidelines.\n        </li>\n        <li>\n          <ExternalLink href=\"https://react-query.tanstack.com/\">\n            react-query\n          </ExternalLink>\n          : A React component for synchronizing server data (from AiiDA) with the UI.\n        </li>\n      </ul>\n      <p>\n        AiiDA Dashboard can be used as a standalone Web UI, or it also provides React\n        components and facilitates wrapping into a JupyterLab{' '}\n        <ExternalLink href=\"https://jupyterlab.readthedocs.io/en/stable/extension/virtualdom.html\">\n          extension widget\n        </ExternalLink>\n        .\n      </p>\n      <p>\n        Alongside work on an{' '}\n        <ExternalLink href=\"https://github.com/aiidateam/AEP/pull/24\">\n          Extended REST API\n        </ExternalLink>\n        , it is hoped that this will offer not just ways to explore your profiles, but\n        also to actively interact them: creating/adding to groups, composing/running\n        workchains, etc.\n      </p>\n    </div>\n  )\n}\n\nfunction ExternalLink(\n  props: React.AnchorHTMLAttributes<HTMLAnchorElement>\n): JSX.Element {\n  return (\n    <a href={props.href} target=\"_blank\" rel=\"noopener\">\n      {props.children}\n    </a>\n  )\n}\n\nexport function GettingStartedBox(): JSX.Element {\n  const classes = useStyles()\n  return (\n    <div>\n      <h2>Getting Started</h2>\n      <p>\n        To use this application, you need to be able to connect to a running AiiDA REST\n        API server.\n      </p>\n      <Alert variant=\"outlined\" severity=\"info\">\n        If you want to try out this app but don't have your own AiiDA profile, you can\n        use this demonstration server:{' '}\n        <ExternalLink href=\"https://15.188.110.176:5000/api/v4\">\n          https://15.188.110.176:5000/api/v4\n        </ExternalLink>\n        , although note currently you will first need to open this address in a separate\n        tab and accept the security certificate (under Advanced).\n      </Alert>\n      <p>\n        To start a server for your own profile, you must have aiida-core installed with\n        the REST dependencies:\n      </p>\n      <SyntaxHighlighter language=\"bash\">\n        {'$ pip install aiida-core[rest]~=1.6.3'}\n      </SyntaxHighlighter>\n      <p>Then you can start your REST server:</p>\n      <SyntaxHighlighter language=\"bash\">\n        {\n          '$ verdi -p myprofile restapi\\n * REST API running on http://127.0.0.1:5000/api/v4'\n        }\n      </SyntaxHighlighter>\n      <p>\n        Take this URL and paste it into the \"REST URL\" box at the top-right of this\n        page. If a connection is available, then you should see the icon turn to:{' '}\n        <MuiIcons.CheckCircle className={classes.InlineIcon} />\n      </p>\n      <p>Now try the tabs on the left of this page!</p>\n    </div>\n  )\n}\n\nexport function DetailedBox(): JSX.Element {\n  return (\n    <div>\n      <h2>Project Discussion</h2>\n      <p>\n        Source repository:{' '}\n        <ExternalLink href=\"https://github.com/chrisjsewell/react-aiida-app\">\n          https://github.com/chrisjsewell/react-aiida-app\n        </ExternalLink>\n      </p>\n      <p>\n        This project is a continuation of{' '}\n        <ExternalLink href=\"https://github.com/chrisjsewell/jlab_aiidatree\">\n          jlab_aiidatree\n        </ExternalLink>\n        , in which we built a working prototype for a JupyterLab extension to interact\n        with AiiDA.\n      </p>\n      <p>\n        During development of <code>jlab_aiidatree</code> it was noted that you can\n        embed <a href=\"https://reactjs.org/\">React components</a> inside of JupyterLab\n        (see{' '}\n        <ExternalLink href=\"https://jupyterlab.readthedocs.io/en/stable/extension/virtualdom.html\">\n          JupyterLab/React\n        </ExternalLink>\n        ).\n      </p>\n      <p>\n        The goal, therefore, is that we can develop this package as a standalone app\n        (which could also be utilised directly via a web server), but also use it as a\n        dependency to generate most of the JupyterLab extension, via React components.\n      </p>\n      <p>The benefit of also using th app within JupyterLab, is:</p>\n      <ol type=\"1\">\n        <li>\n          It provides a platform within which to run the app locally, without having to\n          host it directly\n        </li>\n        <li>\n          It allows us an alternate route to interface with AiiDA: via the “private”\n          REST API interface between the JupyterLab backend and frontend. Using this\n          REST API, will allow us easy access to parts of the AiiDA API that are yet to\n          be exposed in REST, whilst maintaining that formal protocol (enforcing\n          separation of concerns). We can then use this to essentially prototype\n          additions to the AiiDA REST API.\n        </li>\n        <li>\n          It provides the possible to integrate with other aspects of the Jupyter\n          framework (e.g. Notebooks)\n        </li>\n      </ol>\n      <h3 id=\"about-react\">About React</h3>\n      <p>\n        React is an industry leading library, for creating beautiful and responsive UIs,\n        maintained by Facebook and with users including Whatsapp, Dropbox, Uber and\n        Netflix. We also utilise other “best-practice” React components:\n      </p>\n      <ul>\n        <li>\n          <a href=\"https://material-ui.com\">Material-UI</a>: A React component library\n          that implements Google’s{' '}\n          <a href=\"https://material.io/design\">Material Design guidelines</a>\n        </li>\n        <li>\n          <a href=\"https://react-query.tanstack.com/\">react-query</a>: A React component\n          for synchronizing server data (from AiiDA) with the UI.\n        </li>\n      </ul>\n      <p>\n        React itself is really user-friendly to get started with, even with only a small\n        familiarity with HTML and JavaScript, see{' '}\n        <a href=\"https://reactjs.org/tutorial/tutorial.html\">\n          https://reactjs.org/tutorial/tutorial.html\n        </a>\n        . Once learned, it is also incredibly intuitive to generate web elements with,\n        using the{' '}\n        <a href=\"https://reactjs.org/docs/introducing-jsx.html\">\n          <code>.jsx</code> file format\n        </a>\n        . For example a simple React component would look like:\n      </p>\n      <SyntaxHighlighter language=\"jsx\">\n        {`function MyComponent(props) {\n  return (\n    <div>\n      <h1>Hello, world!</h1>\n      <p>Here is a dynamic value: {props.value}</p>\n    </div>\n  )\n}`}\n      </SyntaxHighlighter>\n      <h3 id=\"this-app-vs-materials-cloud-explore\">\n        This app vs Materials Cloud Explore\n      </h3>\n      <p>\n        <b>Update:</b> Materials Cloud is in fact now looking to move to React.\n      </p>\n      <p>\n        Note, initial features of this app are quite similar to{' '}\n        <a href=\"https://www.materialscloud.org/explore/connect\">\n          https://www.materialscloud.org/explore/connect\n        </a>\n        : using the AiiDA REST API as a backend for visualising its data. However, this\n        is built with <a href=\"https://angularjs.org/\">https://angularjs.org/</a> which,\n        although also well used in industry, has two major drawbacks for our use case:\n      </p>\n      <ol type=\"1\">\n        <li>You cannot integrate it with JupyterLab (see benefits above)</li>\n        <li>\n          It does not have the re-usable component infrastructure of React, which should\n          allow us to eventually build an extensible app with “pluggable” extensions.\n        </li>\n      </ol>\n      <h3 id=\"this-app-vs-aiidalab\">This app vs AiiDALab</h3>\n      <p>\n        <a href=\"https://www.materialscloud.org/work/aiidalab\">AiiDALab</a> uses the\n        Jupyter Notebook server to build its frontend, via{' '}\n        <a href=\"https://ipywidgets.readthedocs.io\">ipywidgets</a>, which dynamically\n        generates the HTML/Javascript from python code cells, and appmode/voila which\n        executes the Notebook on page load, then converts the notebook interface to look\n        more like a web app (hiding code cells, etc). Note, despite its name, it does\n        not use JupyterLab per se.\n      </p>\n      <p>The benefits of this approach, is that:</p>\n      <ol type=\"1\">\n        <li>\n          You can code everything in Python/Jupyter Notebooks, which is obviously the\n          background of many working on AiiDA (being a Python package), albeit that, if\n          you want to do anything substantial with these apps you inevitably have to\n          learn some HTML/JavaScript.\n        </li>\n        <li>You can interface directly with the AiiDA Python API</li>\n      </ol>\n      <p>\n        The disadvantage though is that the apps which it creates are substantially\n        limited in the user interfaces (UI) and user experience (UX) they can create.\n      </p>\n      <ol type=\"1\">\n        <li>\n          On every page load you need to first execute the notebook, then render it,\n          meaning loads times are extremely poor by web standards.\n        </li>\n        <li>\n          You are restricted by the semantics/layout of the Notebook, i.e. each app has\n          to be a set of separate pages and in each page you have a set of vertically\n          sequential cells.\n        </li>\n        <li>\n          You are restricted by the semantics/functionality of ipywidgets, by industry\n          standard, a very niche/bespoke tool. In practice, you end up taking a lot of\n          time to learn/create a lot of HTML widgets that have little to no practical\n          reusability, rather than being able to utilise the massive React ecosystem of\n          libraries and components.\n        </li>\n      </ol>\n    </div>\n  )\n}\n","import React, { useContext, useState } from 'react'\n\nimport {\n  Avatar,\n  Button,\n  Chip,\n  CircularProgress,\n  Collapse,\n  List,\n  Divider,\n  ListItem,\n  ListItemAvatar,\n  ListItemIcon,\n  ListItemText,\n  Menu,\n  MenuItem,\n  Tooltip\n} from '@material-ui/core'\nimport { createStyles, Theme, makeStyles } from '@material-ui/core/styles'\nimport * as MuiIcons from '@material-ui/icons'\n\nimport { Alert, Pagination } from '@material-ui/lab'\n\nimport { useQuery } from 'react-query'\nimport copy from 'copy-to-clipboard'\n\nimport {\n  AiidaSettingsContext,\n  getNodes,\n  getNodeIncoming,\n  getNodeOutgoing,\n  getNodeRepoList\n} from '../clients/aiidaClient'\nimport { GitBranchIcon, RocketIcon } from '../icons'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    tree: {\n      width: '100%',\n      maxWidth: 520,\n      backgroundColor: theme.palette.background.paper\n    },\n    refresh: {\n      marginRight: theme.spacing(1)\n    },\n    pagination: {\n      paddingTop: theme.spacing(2),\n      paddingBottom: theme.spacing(1)\n    },\n    listChip: {\n      marginLeft: theme.spacing(1),\n      marginBottom: theme.spacing(1),\n      float: 'right'\n    },\n    item: {\n      maxWidth: 480,\n      overflow: 'hidden'\n    },\n    nested1: {\n      paddingLeft: theme.spacing(4)\n    },\n    nested2: {\n      paddingLeft: theme.spacing(8)\n    }\n  })\n)\n\nconst initialMouseState = {\n  mouseX: null,\n  mouseY: null\n} as { mouseX: null | number; mouseY: null | number }\n\ninterface IAiidaTreeElementProps {\n  pk: number\n  uuid: string\n  elementName?: string\n  header: string\n  info?: string\n  tooltip?: string\n  procLabel?: string\n  procState?: 'created' | 'running' | 'waiting' | 'finished' | 'excepted' | 'killed'\n  procExit?: number\n  nested?: boolean\n}\n\nexport function AiidaNodeTree({ nodePrefix }: { nodePrefix: string }): JSX.Element {\n  /**\n   * a React component housing a list of AiiDA elements\n   */\n\n  const classes = useStyles()\n  const [page, setPage] = useState(1)\n  const handlePageChange = (event: React.ChangeEvent<unknown>, value: number) => {\n    setPage(value)\n  }\n  const aiidaSettings = useContext(AiidaSettingsContext)\n  // TODO usePaginationQuery\n  const result = useQuery(\n    [aiidaSettings.baseUrl, 'nodes', nodePrefix, page],\n    () => getNodes(aiidaSettings.baseUrl, nodePrefix, page),\n    { enabled: aiidaSettings.baseUrl !== null, keepPreviousData: true }\n  )\n\n  let element = <CircularProgress />\n  let pages = 1\n  if (result.isIdle || result.data === null) {\n    element = (\n      <Alert severity=\"info\" icon={<MuiIcons.SyncDisabled />}>\n        Disabled\n      </Alert>\n    )\n  } else if (result.data !== undefined) {\n    pages = Math.ceil(result.data.totalCount / result.data.perPage)\n    if (!result.isPreviousData) {\n      element = (\n        <List component=\"nav\" aria-label=\"main aiida tree\">\n          {result.data.nodes.map(value => {\n            return (\n              <AiidaTreeElement\n                key={`aiida-tree-el-${value.uuid}`}\n                pk={value.id}\n                uuid={value.uuid}\n                header={`${value.id} ${\n                  value.attributes?.process_label || value.label || ''\n                }`}\n                elementName={value.node_type.split('.').slice(0, 2).join('.')}\n                info={`${value.mtime}, ${value.node_type}, ${value.process_type || ''}`}\n                tooltip={`UUID: ${value.uuid}`}\n                procLabel={value.attributes?.process_label}\n                procState={value.attributes?.process_state}\n                procExit={value.attributes?.exit_status}\n              />\n            )\n          })}\n        </List>\n      )\n    }\n  } else if (result.isError) {\n    const error = result.error as { message: string }\n    element = <Alert severity=\"error\">{error.message}</Alert>\n  }\n  let updateInfo = <span></span>\n  if (!!result.dataUpdatedAt) {\n    const date = new Date(result.dataUpdatedAt)\n    updateInfo = <span>Updated: {date.toLocaleString()}</span>\n  }\n\n  return (\n    <div className={classes.tree}>\n      <Button\n        variant=\"outlined\"\n        color=\"primary\"\n        className={classes.refresh}\n        startIcon={<MuiIcons.Refresh />}\n        onClick={() => {\n          result.refetch()\n        }}\n      >\n        Refresh\n      </Button>\n      {updateInfo}\n      <Pagination\n        disabled={result.isPreviousData}\n        className={classes.pagination}\n        color=\"primary\"\n        count={pages}\n        page={page}\n        onChange={handlePageChange}\n      />\n      {element}\n    </div>\n  )\n}\n\n// TODO better value type, custom icons (https://primer.style/octicons/packages/react)\nconst ElementIconMap: { [key: string]: JSX.Element } = {\n  default: <MuiIcons.DeviceUnknown />,\n  folder: <MuiIcons.Inbox />,\n  'data.array': <MuiIcons.GridOn />,\n  'data.bool': <MuiIcons.CheckCircle />,\n  'data.cif': <MuiIcons.ScatterPlot />,\n  'data.code': <MuiIcons.Code />,\n  'data.dict': <MuiIcons.ViewList />,\n  'data.float': <MuiIcons.AllInclusive />,\n  'data.folder': <MuiIcons.Inbox />,\n  'data.int': <MuiIcons.LooksOne />,\n  'data.list': <MuiIcons.List />,\n  'data.numeric': <MuiIcons.PlusOne />,\n  'data.orbital': <MuiIcons.BlurOn />,\n  'data.remote': <MuiIcons.OpenInNew />,\n  'data.str': <MuiIcons.FormatColorText />,\n  'data.structure': <MuiIcons.Grain />,\n  'process.calculation': <RocketIcon />,\n  'process.process': <RocketIcon />,\n  'process.workflow': <GitBranchIcon /> // <MuiIcons.Share />,\n}\n\nfunction AiidaTreeElement(props: IAiidaTreeElementProps): JSX.Element {\n  const classes = useStyles()\n\n  const key = props.elementName === undefined ? 'default' : props.elementName\n  let icon = ElementIconMap[key] || <MuiIcons.DeviceUnknown />\n\n  const [open, setOpen] = React.useState(false)\n  const handleClick = () => {\n    setOpen(!open)\n  }\n\n  const [contextPosition, setContextPosition] =\n    React.useState<{\n      mouseX: null | number\n      mouseY: null | number\n    }>(initialMouseState)\n\n  // TODO currently if you right-click a second time,\n  // it will simply move the current open menu,\n  // not close it and open the \"correct\" context-menu for the position on the screen\n  const handleRightClick = (event: React.MouseEvent<HTMLDivElement>) => {\n    event.preventDefault()\n    setContextPosition({\n      mouseX: event.clientX - 2,\n      mouseY: event.clientY - 4\n    })\n  }\n\n  const handleContextClose = (event: React.MouseEvent) => {\n    event.preventDefault()\n    event.stopPropagation()\n    setContextPosition(initialMouseState)\n  }\n  const copyUUIDtoClipboard = (event: React.MouseEvent) => {\n    event.preventDefault()\n    event.stopPropagation()\n    setContextPosition(initialMouseState)\n    copy(`${props.uuid}`)\n  }\n\n  // TODO react-markdown for tooltip\n  if (props.tooltip !== undefined) {\n    icon = (\n      <Tooltip title={<p>{props.tooltip}</p>}>\n        <span>{icon}</span>\n      </Tooltip>\n    )\n  }\n\n  let title = <span>{props.header}</span>\n  if (['excepted', 'killed'].includes(props.procState || '')) {\n    title = (\n      <span>\n        {props.header}\n        <Chip\n          className={classes.listChip}\n          label={`${props.procState} [${props.procExit}]`}\n          variant=\"outlined\"\n          color=\"secondary\"\n        />\n      </span>\n    )\n  } else if (!!props.procState) {\n    title = (\n      <span>\n        {props.header}\n        <Chip\n          className={classes.listChip}\n          label={`${props.procState} [${props.procExit}]`}\n          variant=\"outlined\"\n          color=\"primary\"\n        />\n      </span>\n    )\n  }\n\n  return (\n    <React.Fragment>\n      <ListItem\n        button\n        onClick={handleClick}\n        onContextMenu={handleRightClick}\n        className={props.nested ? classes.nested2 : undefined}\n      >\n        <ListItemAvatar>\n          <Avatar>{icon}</Avatar>\n        </ListItemAvatar>\n        <ListItemText className={classes.item} primary={title} secondary={props.info} />\n        {/* TODO context menu does not close on a right-click not over the node */}\n        <Menu\n          keepMounted\n          open={contextPosition.mouseY !== null}\n          onClose={handleContextClose}\n          anchorReference=\"anchorPosition\"\n          anchorPosition={\n            contextPosition.mouseY !== null && contextPosition.mouseX !== null\n              ? { top: contextPosition.mouseY, left: contextPosition.mouseX }\n              : undefined\n          }\n        >\n          <ListItem>\n            <b>PK {props.pk} Menu</b>\n          </ListItem>\n          <MenuItem onClick={copyUUIDtoClipboard}>Copy UUID to Clipboard</MenuItem>\n          <MenuItem onClick={handleContextClose}>Close</MenuItem>\n          {/* <MenuItem onClick={handleContextClose}>Open Data</MenuItem>\n                    <MenuItem onClick={handleContextClose}>Add to Group</MenuItem> */}\n        </Menu>\n        {props.nested ? null : open ? <MuiIcons.ExpandMore /> : <MuiIcons.ExpandLess />}\n      </ListItem>\n      {props.nested ? null : <AiidaNodeChildren nodeUUID={props.uuid} open={open} />}\n      <Divider light />\n    </React.Fragment>\n  )\n}\n\nfunction AiidaNodeChildren({\n  nodeUUID,\n  open\n}: {\n  nodeUUID: string | null\n  open: boolean\n}): JSX.Element {\n  const classes = useStyles()\n  const [openRepo, setOpenRepo] = React.useState(false)\n  const handleRepoClick = () => {\n    setOpenRepo(!openRepo)\n  }\n  const [openIncoming, setOpenIncoming] = React.useState(false)\n  const handleIncomingClick = () => {\n    setOpenIncoming(!openIncoming)\n  }\n  const [openOutgoing, setOpenOutgoing] = React.useState(false)\n  const handleOutgoingClick = () => {\n    setOpenOutgoing(!openOutgoing)\n  }\n  return (\n    <Collapse in={open} timeout=\"auto\">\n      <List component=\"div\" disablePadding>\n        <ListItem button onClick={handleRepoClick} className={classes.nested1}>\n          <ListItemIcon>\n            <MuiIcons.Inbox />\n          </ListItemIcon>\n          <ListItemText primary=\"Repository\" />\n          {openRepo ? <MuiIcons.ExpandMore /> : <MuiIcons.ExpandLess />}\n        </ListItem>\n        <Collapse in={openRepo} mountOnEnter>\n          <AiidaRepoList nodeUUID={nodeUUID} />\n        </Collapse>\n        <ListItem button onClick={handleIncomingClick} className={classes.nested1}>\n          <ListItemIcon>\n            <MuiIcons.ArrowForward />\n          </ListItemIcon>\n          <ListItemText primary=\"Incoming\" />\n          {openIncoming ? <MuiIcons.ExpandMore /> : <MuiIcons.ExpandLess />}\n        </ListItem>\n        <Collapse in={openIncoming} mountOnEnter>\n          <AiidaLinkIncomingList nodeUUID={nodeUUID} />\n        </Collapse>\n        <ListItem button onClick={handleOutgoingClick} className={classes.nested1}>\n          <ListItemIcon>\n            <MuiIcons.ArrowBack />\n          </ListItemIcon>\n          <ListItemText primary=\"Outgoing\" />\n          {openOutgoing ? <MuiIcons.ExpandMore /> : <MuiIcons.ExpandLess />}\n        </ListItem>\n        <Collapse in={openOutgoing} mountOnEnter>\n          <AiidaLinkOutgoingList nodeUUID={nodeUUID} />\n        </Collapse>\n      </List>\n    </Collapse>\n  )\n}\n\nfunction AiidaRepoList({ nodeUUID }: { nodeUUID: string | null }): JSX.Element {\n  const classes = useStyles()\n  const aiidaSettings = useContext(AiidaSettingsContext)\n  // TODO usePaginationQuery\n  const result = useQuery(\n    [aiidaSettings.baseUrl, 'nodeRepolist', nodeUUID],\n    () => getNodeRepoList(aiidaSettings.baseUrl, nodeUUID),\n    { enabled: aiidaSettings.baseUrl !== null }\n  )\n\n  let element = <CircularProgress />\n  if (result.isIdle || result.data === null) {\n    element = (\n      <Alert severity=\"info\" icon={<MuiIcons.SyncDisabled />}>\n        Disabled\n      </Alert>\n    )\n  } else if (result.data !== undefined) {\n    element = (\n      <List component=\"nav\" aria-label=\"main aiida repo\">\n        {result.data.map(value => {\n          return (\n            <ListItem className={classes.nested2}>\n              <ListItemIcon>\n                {value.type === 'DIRECTORY' ? (\n                  <MuiIcons.Folder />\n                ) : (\n                  <MuiIcons.Description />\n                )}\n              </ListItemIcon>\n              <ListItemText primary={value.name} />\n            </ListItem>\n          )\n        })}\n      </List>\n    )\n  } else if (result.isError) {\n    const error = result.error as { message: string }\n    element = <Alert severity=\"error\">{error.message}</Alert>\n  }\n\n  return element\n}\n\nfunction AiidaLinkIncomingList({ nodeUUID }: { nodeUUID: string | null }): JSX.Element {\n  const aiidaSettings = useContext(AiidaSettingsContext)\n  const result = useQuery(\n    [aiidaSettings.baseUrl, 'nodeIncoming', nodeUUID],\n    () => getNodeIncoming(aiidaSettings.baseUrl, nodeUUID),\n    { enabled: aiidaSettings.baseUrl !== null }\n  )\n\n  let element = <CircularProgress />\n  if (result.isIdle || result.data === null) {\n    element = (\n      <Alert severity=\"info\" icon={<MuiIcons.SyncDisabled />}>\n        Disabled\n      </Alert>\n    )\n  } else if (result.data !== undefined) {\n    element = (\n      <List component=\"nav\" aria-label=\"main aiida incoming\">\n        {result.data.map(value => {\n          return (\n            <AiidaTreeElement\n              nested={true}\n              pk={value.id}\n              uuid={value.uuid}\n              header={`${value.id} ${value.link_type.toUpperCase()} ${\n                value.link_label\n              }`}\n              elementName={value.node_type.split('.').slice(0, 2).join('.')}\n              info={`${value.mtime}, ${value.node_type}, ${value.process_type || ''}`}\n              tooltip={`UUID: ${value.uuid}`}\n            />\n          )\n        })}\n      </List>\n    )\n  } else if (result.isError) {\n    const error = result.error as { message: string }\n    element = <Alert severity=\"error\">{error.message}</Alert>\n  }\n\n  return element\n}\n\nfunction AiidaLinkOutgoingList({ nodeUUID }: { nodeUUID: string | null }): JSX.Element {\n  const aiidaSettings = useContext(AiidaSettingsContext)\n  const result = useQuery(\n    [aiidaSettings.baseUrl, 'nodeOutgoing', nodeUUID],\n    () => getNodeOutgoing(aiidaSettings.baseUrl, nodeUUID),\n    { enabled: aiidaSettings.baseUrl !== null }\n  )\n\n  let element = <CircularProgress />\n  if (result.isIdle || result.data === null) {\n    element = (\n      <Alert severity=\"info\" icon={<MuiIcons.SyncDisabled />}>\n        Disabled\n      </Alert>\n    )\n  } else if (result.data !== undefined) {\n    element = (\n      <List component=\"nav\" aria-label=\"main aiida incoming\">\n        {result.data.map(value => {\n          return (\n            <AiidaTreeElement\n              nested={true}\n              pk={value.id}\n              uuid={value.uuid}\n              header={`${value.id} ${value.link_type.toUpperCase()} ${\n                value.link_label\n              }`}\n              elementName={value.node_type.split('.').slice(0, 2).join('.')}\n              info={`${value.mtime}, ${value.node_type}, ${value.process_type || ''}`}\n              tooltip={`UUID: ${value.uuid}`}\n            />\n          )\n        })}\n      </List>\n    )\n  } else if (result.isError) {\n    const error = result.error as { message: string }\n    element = <Alert severity=\"error\">{error.message}</Alert>\n  }\n\n  return element\n}\n","import { useState } from 'react'\n\n/**\n * A wrapper for useState, which syncs the state to local storage,\n * so that it persists through a page change/refresh\n */\nexport function useLocalStorage<T>(\n  key: string,\n  initialValue: T\n): readonly [T, (value: T | ((val: T) => T)) => void] {\n  // see https://usehooks.com/useLocalStorage/\n  // State to store our value\n  // Pass initial state function to useState so logic is only executed once\n  const [storedValue, setStoredValue] = useState<T>(() => {\n    try {\n      // Get from local storage by key\n      const item = window.localStorage.getItem(key)\n      // Parse stored json or if none return initialValue\n      return item ? JSON.parse(item) : initialValue\n    } catch (error) {\n      // If error also return initialValue\n      console.log(error)\n      return initialValue\n    }\n  })\n\n  // Return a wrapped version of useState's setter function that ...\n  // ... persists the new value to localStorage.\n  const setValue = (value: T | ((val: T) => T)) => {\n    try {\n      // Allow value to be a function so we have same API as useState\n      const valueToStore = value instanceof Function ? value(storedValue) : value\n      // Save state\n      setStoredValue(valueToStore)\n      // Save to local storage\n      window.localStorage.setItem(key, JSON.stringify(valueToStore))\n    } catch (error) {\n      // A more advanced implementation would handle the error case\n      console.log(error)\n    }\n  }\n\n  return [storedValue, setValue] as const\n}\n","import React, { useContext } from 'react'\n\nimport Grid from '@material-ui/core/Grid'\nimport Paper from '@material-ui/core/Paper'\nimport FormControl from '@material-ui/core/FormControl'\nimport InputLabel from '@material-ui/core/InputLabel'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport Select from '@material-ui/core/Select'\nimport Accordion from '@material-ui/core/Accordion'\nimport AccordionSummary from '@material-ui/core/AccordionSummary'\nimport AccordionDetails from '@material-ui/core/AccordionDetails'\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore'\nimport CircularProgress from '@material-ui/core/CircularProgress'\n// import Box from '@material-ui/core/Box';\nimport TextField from '@material-ui/core/TextField'\n\nimport { useQuery } from 'react-query'\nimport ReactJson from 'react-json-view'\n\nimport { AiidaSettingsContext, getNodeStatistics, getNode } from './clients/aiidaClient'\nimport { AiidaNodeTree } from './components/nodeTree'\nimport { useStyles } from './styles'\nimport { useLocalStorage } from './hooks'\n\nexport function PageNodeExplorer(): JSX.Element {\n  const classes = useStyles()\n  const [nodePrefix, setnodePrefix] = useLocalStorage(\n    'aiida-node-explorer-type-prefix',\n    ''\n  )\n  const [nodeFieldsUUID, setnodeFieldsUUID] = useLocalStorage(\n    'aiida-node-explorer-field-uuid',\n    null as string | null\n  )\n  const [expandedTabs, setExpandedTabs] = useLocalStorage(\n    'aiida-node-explorer-expanded',\n    ['intro']\n  )\n  function changeExpanded(tab: string, expanded: boolean) {\n    const tabs = new Set(expandedTabs)\n    if (expanded) {\n      tabs.add(tab)\n    } else {\n      tabs.delete(tab)\n    }\n    setExpandedTabs(Array.from(tabs))\n  }\n\n  return (\n    <Grid container spacing={2} className={classes.mainGrid} direction=\"row-reverse\">\n      <Grid item xs={12} sm={12} md={6}>\n        <Paper variant=\"outlined\" className={classes.paper}>\n          <Accordion\n            defaultExpanded={expandedTabs.includes('intro')}\n            onChange={(event: React.ChangeEvent<unknown>, expanded: boolean) => {\n              changeExpanded('intro', expanded)\n            }}\n          >\n            <AccordionSummary expandIcon={<ExpandMoreIcon />}>\n              <h3>AiiDA Node Explorer</h3>\n            </AccordionSummary>\n            <AccordionDetails>\n              <NodeExplorerIntroduction />\n            </AccordionDetails>\n          </Accordion>\n          <Accordion\n            defaultExpanded={expandedTabs.includes('filters')}\n            onChange={(event: React.ChangeEvent<unknown>, expanded: boolean) => {\n              changeExpanded('filters', expanded)\n            }}\n          >\n            <AccordionSummary expandIcon={<ExpandMoreIcon />}>\n              <h3>Filters</h3>\n            </AccordionSummary>\n            <AccordionDetails>\n              <NodeExplorerFilters\n                nodePrefix={nodePrefix}\n                setnodePrefix={setnodePrefix}\n              />\n            </AccordionDetails>\n          </Accordion>\n          <Accordion\n            defaultExpanded={expandedTabs.includes('fields')}\n            onChange={(event: React.ChangeEvent<unknown>, expanded: boolean) => {\n              changeExpanded('fields', expanded)\n            }}\n          >\n            <AccordionSummary expandIcon={<ExpandMoreIcon />}>\n              <h3>Database Fields</h3>\n            </AccordionSummary>\n            <AccordionDetails className={classes.overflowAuto}>\n              <NodeExplorerAttributes\n                nodeFieldsUUID={nodeFieldsUUID}\n                setnodeFieldsUUID={setnodeFieldsUUID}\n              />\n            </AccordionDetails>\n          </Accordion>\n          <Accordion\n            defaultExpanded={expandedTabs.includes('files')}\n            onChange={(event: React.ChangeEvent<unknown>, expanded: boolean) => {\n              changeExpanded('files', expanded)\n            }}\n          >\n            <AccordionSummary expandIcon={<ExpandMoreIcon />}>\n              <h3>File Contents</h3>\n            </AccordionSummary>\n            <AccordionDetails>TODO ...</AccordionDetails>\n          </Accordion>\n        </Paper>\n      </Grid>\n\n      <Grid item xs={12} sm={12} md={6}>\n        <Paper variant=\"outlined\" className={classes.paper}>\n          <AiidaNodeTree nodePrefix={nodePrefix} />\n        </Paper>\n      </Grid>\n    </Grid>\n  )\n}\n\nexport function NodeExplorerIntroduction(): JSX.Element {\n  return (\n    <div>\n      <p>\n        The node explorer allows you to visualise the nodes in your AiiDA profile as a\n        filtered tree.\n      </p>\n      <p>Use the filter section below to select which node type you want to explore.</p>\n      <p>\n        You can right-click on a node to see additional actions, including copying its\n        UUID to the clipboard. You can use this to show all of if its content in the\n        \"Database Fields\" section.\n      </p>\n    </div>\n  )\n}\n\nconst nodePrefixesDefault = {\n  '': null,\n  'data.': null,\n  'data.array.': null,\n  'data.bool.': null,\n  'data.cif.': null,\n  'data.code.': null,\n  'data.dict.': null,\n  'data.float.': null,\n  'data.folder.': null,\n  'data.int.': null,\n  'data.list.': null,\n  'data.numeric.': null,\n  'data.orbital.': null,\n  'data.remote.': null,\n  'data.structure.': null,\n  'process.': null,\n  'process.calculation.': null,\n  'process.workflow.': null\n} as { [key: string]: null | number }\n\nexport function NodeExplorerFilters({\n  nodePrefix,\n  setnodePrefix\n}: {\n  nodePrefix: string\n  setnodePrefix: React.Dispatch<React.SetStateAction<string>>\n}): JSX.Element {\n  const classes = useStyles()\n  const aiidaSettings = useContext(AiidaSettingsContext)\n  const result = useQuery(\n    [aiidaSettings.baseUrl, 'statistics'],\n    () => getNodeStatistics(aiidaSettings.baseUrl),\n    { enabled: aiidaSettings.baseUrl !== null }\n  )\n\n  let nodePrefixes = nodePrefixesDefault\n  if (result.data) {\n    nodePrefixes = result.data.types\n    // TODO do this programmatically\n    nodePrefixes[''] = result.data.total\n    nodePrefixes['data.'] = null\n    nodePrefixes['process.'] = null\n    nodePrefixes['process.calculation.'] = null\n    nodePrefixes['process.workflow.'] = null\n  }\n\n  return (\n    <React.Fragment>\n      <FormControl className={classes.formControl}>\n        <InputLabel id=\"node-prefix-select-label\">Node Type Prefix</InputLabel>\n        <Select\n          labelId=\"node-prefix-select-label\"\n          id=\"node-prefix-select\"\n          value={nodePrefix}\n          onChange={(event: React.ChangeEvent<{ value: unknown }>) => {\n            setnodePrefix(event.target.value as string)\n          }}\n        >\n          {Object.entries(nodePrefixes)\n            .sort()\n            .map(([name, count]) => (\n              <MenuItem value={name}>\n                {count === null ? name : `${name || 'ALL'} (${count})`}\n              </MenuItem>\n            ))}\n        </Select>\n      </FormControl>\n    </React.Fragment>\n  )\n}\n\nexport function NodeExplorerAttributes({\n  nodeFieldsUUID,\n  setnodeFieldsUUID\n}: {\n  nodeFieldsUUID: null | string\n  setnodeFieldsUUID: React.Dispatch<React.SetStateAction<string | null>>\n}): JSX.Element {\n  const classes = useStyles()\n  const aiidaSettings = useContext(AiidaSettingsContext)\n  const result = useQuery(\n    [aiidaSettings.baseUrl, 'node', nodeFieldsUUID],\n    () => getNode(aiidaSettings.baseUrl, nodeFieldsUUID),\n    { enabled: aiidaSettings.baseUrl !== null }\n  )\n  const handleUUIDChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    setnodeFieldsUUID(event.target.value)\n  }\n  let view = null as null | JSX.Element\n  if (result.data) {\n    view = <ReactJson src={result.data} collapseStringsAfterLength={40} />\n  } else if (result.isFetching) {\n    view = <CircularProgress />\n  }\n  return (\n    <Grid container>\n      <Grid xs={12}>\n        <TextField\n          label=\"UUID\"\n          value={nodeFieldsUUID}\n          onChange={handleUUIDChange}\n          error={!!result.error}\n          helperText={!result.error ? undefined : `${result.error}`}\n          fullWidth\n        />\n      </Grid>\n      <Grid xs={12} className={classes.padTop}>\n        {view}\n      </Grid>\n    </Grid>\n  )\n}\n","import React, { useContext, useEffect, useRef } from 'react'\n\nimport ForceGraph2D, {\n  NodeObject,\n  LinkObject\n  // ForceGraphMethods\n} from 'react-force-graph-2d'\nimport { forceCollide } from 'd3-force'\nimport { useQuery } from 'react-query'\nimport { SizeMe } from 'react-sizeme'\n\nimport {\n  AiidaSettingsContext,\n  IAiidaRestNodeLinkItem,\n  getNodeOutgoing,\n  getNodeIncoming\n} from '../clients/aiidaClient'\n\nexport type DagType = 'td' | 'bu' | 'lr' | 'rl' | 'radialout' | 'radialin'\n\ninterface Node2dObject extends NodeObject {\n  name?: string\n  label?: string\n  color?: string\n  fillColor?: string\n  val?: number\n  __bckgDimensions?: number[]\n}\n\nexport function AiidaProvenanceGraph({\n  nodeUUID,\n  dagMode,\n  dagLevelDistance\n}: {\n  nodeUUID: string | null\n  dagMode: DagType\n  dagLevelDistance: number\n}): JSX.Element {\n  const fgRef = useRef()\n  const aiidaSettings = useContext(AiidaSettingsContext)\n  const resultIncoming = useQuery(\n    [aiidaSettings.baseUrl, 'nodeIncoming', nodeUUID],\n    () => getNodeIncoming(aiidaSettings.baseUrl, nodeUUID),\n    { enabled: aiidaSettings.baseUrl !== null }\n  )\n  const resultOutgoing = useQuery(\n    [aiidaSettings.baseUrl, 'nodeOutgoing', nodeUUID],\n    () => getNodeOutgoing(aiidaSettings.baseUrl, nodeUUID),\n    { enabled: aiidaSettings.baseUrl !== null }\n  )\n\n  useEffect(() => {\n    // add collision force\n    const fg = fgRef.current as undefined | any // ForceGraphMethods\n    if (fg !== undefined) {\n      // Deactivate existing forces\n      fg.d3Force('charge', null)\n      fg.d3Force('collision', forceCollide(15))\n      // fg.d3Force('box' ...\n    }\n  }, [resultIncoming, resultOutgoing])\n\n  const rootNode = {\n    id: 'root',\n    name: 'root',\n    label: 'ROOT',\n    val: 2,\n    color: 'red'\n  } as Node2dObject\n  const nodes = [rootNode] as Node2dObject[]\n  const links = [] as LinkObject[]\n\n  if (resultIncoming.data) {\n    nodes.push(\n      ...resultIncoming.data.map(node => {\n        return createNodeData(node)\n      })\n    )\n    links.push(\n      ...resultIncoming.data.map(node => {\n        return {\n          target: 'root',\n          source: `${node.id}`,\n          name: `${node.link_label}`\n        }\n      })\n    )\n  }\n  if (resultOutgoing.data) {\n    nodes.push(\n      ...resultOutgoing.data.map(node => {\n        return createNodeData(node)\n      })\n    )\n    links.push(\n      ...resultOutgoing.data.map(node => {\n        return {\n          source: 'root',\n          target: `${node.id}`,\n          name: `${node.link_label}`\n        }\n      })\n    )\n  }\n\n  const data = {\n    nodes: nodes,\n    links: links\n  }\n  return (\n    <SizeMe>\n      {({ size }) => (\n        <ForceGraph2D\n          ref={fgRef}\n          graphData={data}\n          width={size.width === null ? undefined : size.width}\n          height={size.height === null ? undefined : size.height}\n          dagMode={dagMode}\n          dagLevelDistance={dagLevelDistance}\n          nodeCanvasObject={nodeCanvasObject}\n          linkDirectionalArrowLength={3.5}\n          linkDirectionalArrowRelPos={1}\n        />\n      )}\n    </SizeMe>\n  )\n}\n\nfunction createNodeData(node: IAiidaRestNodeLinkItem): Node2dObject {\n  const node_type = node.node_type.split('.')\n  node_type.pop()\n  return {\n    id: `${node.id}`,\n    name: `${node.id}${node.process_type ? ', ' + node.process_type : ''}`,\n    label: node_type.pop(),\n    val: 40,\n    color: 'blue'\n  }\n}\n\nfunction nodeCanvasObject(\n  node: Node2dObject,\n  ctx: CanvasRenderingContext2D,\n  globalScale: number\n): void {\n  const label = `${node.label || ''}`\n  const fontSize = 12 / globalScale\n  ctx.font = `${fontSize}px Sans-Serif`\n  const textWidth = ctx.measureText(label).width\n  const bckgDimensions = [textWidth, fontSize].map(n => n + fontSize * 0.2) // some padding\n\n  ctx.textAlign = 'center'\n  ctx.textBaseline = 'middle'\n  ctx.strokeStyle = 'rgba(0, 0, 0, 0.1)'\n  if (node.x !== undefined && node.y !== undefined) {\n    if (node.fillColor) {\n      ctx.fillStyle = node.fillColor || 'rgba(255, 255, 255, 0.8)'\n      ctx.fillRect(\n        node.x - bckgDimensions[0] / 2,\n        node.y - bckgDimensions[1] / 2,\n        bckgDimensions[0],\n        bckgDimensions[1]\n      )\n    }\n    ctx.strokeRect(\n      node.x - bckgDimensions[0] / 2,\n      node.y - bckgDimensions[1] / 2,\n      bckgDimensions[0],\n      bckgDimensions[1]\n    )\n    ctx.fillStyle = node.color || 'white'\n    ctx.fillText(label, node.x, node.y)\n  }\n\n  node.__bckgDimensions = bckgDimensions // to re-use in nodePointerAreaPaint\n}\n","import React from 'react'\n\nimport Grid from '@material-ui/core/Grid'\nimport Paper from '@material-ui/core/Paper'\nimport TextField from '@material-ui/core/TextField'\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore'\nimport Accordion from '@material-ui/core/Accordion'\nimport AccordionSummary from '@material-ui/core/AccordionSummary'\nimport AccordionDetails from '@material-ui/core/AccordionDetails'\nimport FormControl from '@material-ui/core/FormControl'\nimport InputLabel from '@material-ui/core/InputLabel'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport Select from '@material-ui/core/Select'\nimport Typography from '@material-ui/core/Typography'\nimport Slider from '@material-ui/core/Slider'\n\nimport { Link } from 'react-router-dom'\n\nimport { uuidPattern } from './clients/aiidaClient'\nimport { useStyles } from './styles'\nimport PageKeys from './pages'\nimport { useLocalStorage } from './hooks'\nimport { AiidaProvenanceGraph, DagType } from './components/provenanceGraph'\n\nexport function PageProvenanceGraph(): JSX.Element {\n  const classes = useStyles()\n  const [rootUUID, setrootUUID] = useLocalStorage(\n    'aiida-provenence-graph-root-uuid',\n    null as null | string\n  )\n  const [dagMode, setdagMode] = useLocalStorage(\n    'aiida-provenence-graph-dag-mode',\n    'lr' as DagType\n  )\n  const [dagLevelDistance, setdagLevelDistance] = useLocalStorage(\n    'aiida-provenence-graph-dag-level-dist',\n    50\n  )\n\n  const handleUUIDChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    setrootUUID(event.target.value)\n  }\n\n  return (\n    <Grid container spacing={2} className={classes.mainGrid} direction=\"row-reverse\">\n      <Grid item xs={12} sm={12} md={6}>\n        <Paper variant=\"outlined\" className={classes.paper}>\n          <Accordion defaultExpanded>\n            <AccordionSummary expandIcon={<ExpandMoreIcon />}>\n              <h3>Provenance Graph Visualisation</h3>\n            </AccordionSummary>\n            <AccordionDetails>\n              <ProvenanceGraphIntroduction />\n            </AccordionDetails>\n          </Accordion>\n        </Paper>\n      </Grid>\n      <Grid item xs={12} sm={12} md={6}>\n        <Paper variant=\"outlined\" className={classes.paper}>\n          <TextField\n            label=\"Root UUID\"\n            value={rootUUID || ''}\n            onChange={handleUUIDChange}\n            error={rootUUID ? !uuidPattern.test(rootUUID) : false}\n            // helperText={!result.error ? undefined : `${result.error}`}\n            fullWidth\n          />\n          <FormControl className={classes.formControl}>\n            <InputLabel id=\"dag-mode-select-label\">DAG Mode</InputLabel>\n            <Select\n              labelId=\"dag-mode-select-label\"\n              id=\"dag-mode-select\"\n              value={dagMode}\n              onChange={(event: React.ChangeEvent<{ value: unknown }>) => {\n                setdagMode(event.target.value as DagType)\n              }}\n            >\n              {['td', 'bu', 'lr', 'rl', 'radialout', 'radialin'].map(name => (\n                <MenuItem value={name}>{name}</MenuItem>\n              ))}\n            </Select>\n\n            <Typography id=\"discrete-slider\" gutterBottom>\n              DAG Level Distance\n            </Typography>\n            <Slider\n              defaultValue={dagLevelDistance}\n              aria-labelledby=\"discrete-slider\"\n              valueLabelDisplay=\"auto\"\n              step={10}\n              marks\n              min={10}\n              max={200}\n              onChange={(\n                event: React.ChangeEvent<unknown>,\n                value: number | number[]\n              ) => {\n                setdagLevelDistance(value as number)\n              }}\n            />\n          </FormControl>\n          <AiidaProvenanceGraph\n            nodeUUID={rootUUID}\n            dagMode={dagMode}\n            dagLevelDistance={dagLevelDistance}\n          />\n        </Paper>\n      </Grid>\n    </Grid>\n  )\n}\n\nexport function ProvenanceGraphIntroduction(): JSX.Element {\n  return (\n    <div>\n      <p>This is a work in progress!</p>\n      <p>\n        Input a root node UUID (you can copy one from the{' '}\n        <Link to={PageKeys.nodeExplorer}>Node explorer</Link>) and you will see a\n        visualisation of its local provenance graph.\n      </p>\n      <p>\n        Hover over a node or link to see more information about it (you may have to\n        click on the area first).\n      </p>\n      <p>Eventually it is intended to add features like click-to-expand.</p>\n    </div>\n  )\n}\n","import get from 'lodash.get'\nimport { Color, Vector3 } from 'three'\n\nimport { IAiidaRestNode } from '../clients/aiidaClient'\n\nexport interface IStructureKind {\n  name: string\n  mass: number\n  symbols: string[]\n  weights: number[]\n  [key: string]: any\n}\n\nexport type IStructureCell = [\n  [number, number, number],\n  [number, number, number],\n  [number, number, number]\n]\n\nexport interface IStructureDataAttrs {\n  cell: IStructureCell\n  kinds: IStructureKind[]\n  pbc1: boolean\n  pbc2: boolean\n  pbc3: boolean\n  sites: {\n    kind_name: string\n    position: [number, number, number]\n  }[]\n}\n\nexport interface IStructureData extends IAiidaRestNode {\n  attributes: IStructureDataAttrs\n}\n\n/** Get the length of a 3D vector */\nexport function vectorLength(point: [number, number, number]): string {\n  const vector = new Vector3(...point)\n  return vector.length().toFixed(2)\n}\n\n/** Convert list of kinds to a mapping of the kind name to the element name.\n * We take only the first element name in the list\n */\nexport function kinds2elMap(kinds: IStructureKind[]): {\n  [key: string]: string\n} {\n  return kinds.reduce((prev, current) => {\n    prev[current.name] = current.symbols.length ? current.symbols[0] : 'XX'\n    return prev\n  }, {} as { [key: string]: string })\n}\n\n/** Convert element to a color for use with CSS */\nexport function element2colorCss(elementName: string): string {\n  const color = new Color(...get(atomData, elementName, [1, 0, 1, 0]).slice(1, 4))\n  return `rgb(${color.r * 255},${color.g * 255},${color.b * 255})`\n}\n\n/** Convert element to a color for use with Three JS */\nexport function element2colorThree(elementName: string): Color {\n  return new Color(...get(atomData, elementName, [1, 0, 1, 0]).slice(1, 4))\n}\n\n/** Convert element to a radius */\nexport function element2radius(elementName: string): number {\n  return get(atomData, elementName, [1])[0]\n}\n\n/** element name -> (radius, red, blue, green) */\nexport const atomData = {\n  XX: [0.8, 0.3, 0.3, 0.3],\n  H: [0.46, 1.0, 0.8, 0.8],\n  He: [1.22, 0.98907, 0.91312, 0.81091],\n  Li: [1.57, 0.52731, 0.87953, 0.4567],\n  Be: [1.12, 0.37147, 0.8459, 0.48292],\n  B: [0.81, 0.1249, 0.63612, 0.05948],\n  C: [0.77, 0.5043, 0.28659, 0.16236],\n  N: [0.74, 0.69139, 0.72934, 0.9028],\n  O: [0.74, 0.99997, 0.01328, 0.0],\n  F: [0.72, 0.69139, 0.72934, 0.9028],\n  Ne: [1.6, 0.99954, 0.21788, 0.71035],\n  Na: [1.91, 0.97955, 0.86618, 0.23787],\n  Mg: [1.6, 0.98773, 0.48452, 0.0847],\n  Al: [1.43, 0.50718, 0.70056, 0.84062],\n  Si: [1.18, 0.10596, 0.23226, 0.98096],\n  P: [1.1, 0.75557, 0.61256, 0.76425],\n  S: [1.04, 1.0, 0.98071, 0.0],\n  Cl: [0.99, 0.19583, 0.98828, 0.01167],\n  Ar: [1.92, 0.81349, 0.99731, 0.77075],\n  K: [2.35, 0.63255, 0.13281, 0.96858],\n  Ca: [1.97, 0.35642, 0.58863, 0.74498],\n  Sc: [1.64, 0.71209, 0.3893, 0.67279],\n  Ti: [1.47, 0.47237, 0.79393, 1.0],\n  V: [1.35, 0.9, 0.1, 0.0],\n  Cr: [1.29, 0.0, 0.0, 0.62],\n  Mn: [1.37, 0.66148, 0.03412, 0.62036],\n  Fe: [1.26, 0.71051, 0.44662, 0.00136],\n  Co: [1.25, 0.0, 0.0, 0.68666],\n  Ni: [1.25, 0.72032, 0.73631, 0.74339],\n  Cu: [1.28, 0.1339, 0.28022, 0.86606],\n  Zn: [1.37, 0.56123, 0.56445, 0.50799],\n  Ga: [1.53, 0.62292, 0.89293, 0.45486],\n  Ge: [1.22, 0.49557, 0.43499, 0.65193],\n  As: [1.21, 0.45814, 0.81694, 0.34249],\n  Se: [1.04, 0.6042, 0.93874, 0.06122],\n  Br: [1.14, 0.49645, 0.19333, 0.01076],\n  Kr: [1.98, 0.98102, 0.75805, 0.95413],\n  Rb: [2.5, 1.0, 0.0, 0.6],\n  Sr: [2.15, 0.0, 1.0, 0.15259],\n  Y: [1.82, 0.40259, 0.59739, 0.55813],\n  Zr: [1.6, 0.0, 1.0, 0.0],\n  Nb: [1.47, 0.29992, 0.70007, 0.46459],\n  Mo: [1.4, 0.70584, 0.52602, 0.68925],\n  Tc: [1.35, 0.80574, 0.68699, 0.79478],\n  Ru: [1.34, 0.81184, 0.72113, 0.68089],\n  Rh: [1.34, 0.80748, 0.82205, 0.67068],\n  Pd: [1.37, 0.75978, 0.76818, 0.72454],\n  Ag: [1.44, 0.72032, 0.73631, 0.74339],\n  Cd: [1.52, 0.95145, 0.12102, 0.86354],\n  In: [1.67, 0.84378, 0.50401, 0.73483],\n  Sn: [1.58, 0.60764, 0.56052, 0.72926],\n  Sb: [1.41, 0.84627, 0.51498, 0.31315],\n  Te: [1.37, 0.67958, 0.63586, 0.32038],\n  I: [1.33, 0.55914, 0.122, 0.54453],\n  Xe: [2.18, 0.60662, 0.63218, 0.97305],\n  Cs: [2.72, 0.05872, 0.99922, 0.72578],\n  Ba: [2.24, 0.11835, 0.93959, 0.17565],\n  La: [1.88, 0.3534, 0.77057, 0.28737],\n  Ce: [1.82, 0.82055, 0.99071, 0.02374],\n  Pr: [1.82, 0.9913, 0.88559, 0.02315],\n  Nd: [1.82, 0.98701, 0.5556, 0.02744],\n  Pm: [1.81, 0.0, 0.0, 0.96],\n  Sm: [1.81, 0.99042, 0.02403, 0.49195],\n  Eu: [2.06, 0.98367, 0.03078, 0.83615],\n  Gd: [1.79, 0.75325, 0.01445, 1.0],\n  Tb: [1.77, 0.44315, 0.01663, 0.99782],\n  Dy: [1.77, 0.1939, 0.02374, 0.99071],\n  Ho: [1.76, 0.02837, 0.25876, 0.98608],\n  Er: [1.75, 0.28688, 0.45071, 0.23043],\n  Tm: [1.0, 0.0, 0.0, 0.88],\n  Yb: [1.94, 0.15323, 0.99165, 0.95836],\n  Lu: [1.72, 0.15097, 0.99391, 0.71032],\n  Hf: [1.59, 0.70704, 0.70552, 0.3509],\n  Ta: [1.47, 0.71952, 0.60694, 0.33841],\n  W: [1.41, 0.55616, 0.54257, 0.50178],\n  Re: [1.37, 0.70294, 0.69401, 0.55789],\n  Os: [1.35, 0.78703, 0.69512, 0.47379],\n  Ir: [1.36, 0.78975, 0.81033, 0.45049],\n  Pt: [1.39, 0.79997, 0.77511, 0.75068],\n  Au: [1.44, 0.99628, 0.70149, 0.22106],\n  Hg: [1.55, 0.8294, 0.72125, 0.79823],\n  Tl: [1.71, 0.58798, 0.53854, 0.42649],\n  Pb: [1.75, 0.32386, 0.32592, 0.35729],\n  Bi: [1.82, 0.82428, 0.18732, 0.97211],\n  Po: [1.77, 0.0, 0.0, 1.0],\n  At: [0.62, 0.0, 0.0, 1.0],\n  Rn: [0.8, 1.0, 1.0, 0.0],\n  Fr: [1.0, 0.0, 0.0, 0.0],\n  Ra: [2.35, 0.42959, 0.66659, 0.34786],\n  Ac: [2.03, 0.39344, 0.62101, 0.45034],\n  Th: [1.8, 0.14893, 0.99596, 0.47106],\n  Pa: [1.63, 0.16101, 0.98387, 0.20855],\n  U: [1.56, 0.47774, 0.63362, 0.66714],\n  Np: [1.56, 0.3, 0.3, 0.3],\n  Pu: [1.64, 0.3, 0.3, 0.3],\n  Am: [1.73, 0.3, 0.3, 0.3]\n}\n","import React, { useRef } from 'react'\n\nimport { Canvas } from '@react-three/fiber'\nimport { Center, Line, OrbitControls } from '@react-three/drei'\nimport { Vector3 } from 'three'\n\nimport {\n  IStructureDataAttrs,\n  IStructureCell,\n  element2radius,\n  element2colorThree,\n  kinds2elMap\n} from './structureUtils'\n\n/** Create a 3D scene for a single StructureData  */\nexport function Structure3DViewer(props: {\n  data: IStructureDataAttrs\n  withBox: boolean\n  images: [number, number, number][]\n  height?: number | undefined\n  width?: number | undefined\n}): JSX.Element {\n  // TODO I would like to add a PerspectiveCamera, to change the FoV,\n  // but can't work out how to integrate it with the OrbitControls\n  // https://github.com/pmndrs/drei/issues/402\n  return (\n    <Canvas\n      className=\"structure-3d-viewer\"\n      style={{ height: props.height, width: props.width }}\n    >\n      <OrbitControls />\n\n      <ambientLight castShadow />\n      <pointLight position={[10, 10, 10]} />\n\n      <Center alignTop={false}>\n        <Structure data={props.data} images={props.images} withBox={props.withBox} />\n      </Center>\n    </Canvas>\n  )\n}\n\nStructure3DViewer.defaultProps = {\n  withBox: true,\n  images: [[0, 0, 0]]\n}\n\n/** Render a single AiiDA StructureData */\nexport function Structure(props: {\n  data: IStructureDataAttrs\n  withBox: boolean\n  images: [number, number, number][]\n}): JSX.Element {\n  const [[ax, ay, az], [bx, by, bz], [cx, cy, cz]] = props.data.cell\n  const sites = props.data.sites\n  const kindMap = kinds2elMap(props.data.kinds)\n  let boxes = null\n  if (props.withBox) {\n    boxes = (\n      <React.Fragment>\n        {props.images.map(([na, nb, nc]) => {\n          const newCell = [\n            [ax + ax * na, ay + ay * na, az + az * na],\n            [bx + bx * nb, by + by * nb, bz + bz * nb],\n            [cx + cx * nc, cy + cy * nc, cz + cz * nc]\n          ]\n          return <BoundingBox cell={newCell as IStructureCell} />\n        })}\n      </React.Fragment>\n    )\n  }\n  return (\n    <React.Fragment>\n      {boxes}\n      {props.images.map(([na, nb, nc]) => {\n        return sites.map(site => {\n          const [px, py, pz] = site.position\n          return (\n            <Atom\n              position={\n                new Vector3(\n                  px + ax * na + bx * nb + cx * nc,\n                  py + ay * na + by * nb + cy * nc,\n                  pz + az * na + bz * nb + cz * nc\n                )\n              }\n              radius={element2radius(kindMap[site.kind_name])}\n              color={element2colorThree(kindMap[site.kind_name])}\n            />\n          )\n        })\n      })}\n    </React.Fragment>\n  )\n}\n\nStructure.defaultProps = {\n  withBox: true,\n  images: [[0, 0, 0]]\n}\n\n/** Render a single atoms as a sphere */\nexport function Atom(props: {\n  position: Vector3\n  radius: number\n  color: string | number | THREE.Color\n  opacity: number\n}): JSX.Element {\n  // This reference will give us direct access to the mesh\n  const mesh = useRef() as any\n  return (\n    <mesh ref={mesh} position={props.position}>\n      <sphereBufferGeometry args={[props.radius, 30, 30]} />\n      <meshLambertMaterial\n        color={props.color}\n        transparent={true}\n        opacity={props.opacity}\n      />\n    </mesh>\n  )\n}\n\nAtom.defaultProps = {\n  radius: 1,\n  color: 'blue',\n  opacity: 0.9\n}\n\nfunction add(v1: Vector3, v2: Vector3): Vector3 {\n  return new Vector3(v1.x + v2.x, v1.y + v2.y, v1.z + v2.z)\n}\n\n/** Draw the boundary box for the unit cell */\nfunction BoundingBox({ cell }: { cell: IStructureCell }): JSX.Element {\n  const root = new Vector3(0, 0, 0)\n  const x = new Vector3(...cell[0])\n  const y = new Vector3(...cell[1])\n  const z = new Vector3(...cell[2])\n  return (\n    <React.Fragment>\n      <Line\n        points={[\n          root,\n          x,\n          add(x, z),\n          z,\n          root,\n          y,\n          add(y, x),\n          add(add(y, x), z),\n          add(y, z),\n          y,\n          root\n        ]}\n        color=\"black\"\n        lineWidth={1}\n        transparent={true}\n        opacity={0.9}\n        dashed={true}\n      />\n      <Line points={[z, add(y, z)]} color=\"black\" lineWidth={1} dashed={true} />\n      <Line\n        points={[add(x, z), add(add(y, x), z)]}\n        color=\"black\"\n        lineWidth={1}\n        dashed={true}\n      />\n    </React.Fragment>\n  )\n}\n","import { DataGrid, GridColDef, GridCellParams } from '@material-ui/data-grid'\nimport { useTheme } from '@material-ui/core/styles'\nimport Avatar from '@material-ui/core/Avatar'\n\nimport { IStructureDataAttrs, element2colorCss, kinds2elMap } from './structureUtils'\n\n/** Create a table of the atoms */\nexport function StructureTable({ data }: { data: IStructureDataAttrs }): JSX.Element {\n  const theme = useTheme()\n  const kindMap = kinds2elMap(data.kinds)\n  const columns: GridColDef[] = [\n    {\n      field: 'element',\n      headerName: 'Element',\n      width: 140,\n      renderCell: (params: GridCellParams) => {\n        const color = element2colorCss(`${params.value}`)\n        return (\n          <Avatar\n            style={{\n              backgroundColor: color,\n              color: theme.palette.getContrastText(color)\n            }}\n          >\n            {params.value}\n          </Avatar>\n        )\n      }\n    },\n    { field: 'kind', headerName: 'Kind', width: 120 },\n    { field: 'x', headerName: 'X', type: 'number' },\n    { field: 'y', headerName: 'Y', type: 'number' },\n    { field: 'z', headerName: 'Z', type: 'number' }\n  ]\n  const rows = data.sites.map((site, index) => {\n    return {\n      id: index,\n      element: kindMap[site.kind_name],\n      kind: site.kind_name,\n      x: site.position[0],\n      y: site.position[0],\n      z: site.position[0]\n    }\n  })\n  return (\n    <div style={{ width: '100%' }} className=\"structure-table\">\n      <DataGrid autoHeight rows={rows} columns={columns} />\n    </div>\n  )\n}\n","// Implementation of https://github.com/Materials-Consortia/OPTIMADE/blob/master/optimade.rst\n\n// we take the types from https://github.com/tilde-lab/optimade-client/blob/main/src/types.ts\n// but the actual API is not exactly what we want\nimport { Types } from 'optimade'\n\n// This is the whole process:\n// 1. Get provider JSON (https://providers.optimade.org/providers.json)\n// 2. Get version from `meta.api_version`\n// 3. For each provider in `data`, if they have a non-null `attributes.base_url`\n// 4. Go to `attributes.base_url` + version + '/info' and check they have 'links' in attributes.available_endpoints, if so\n// 5. Go to `attributes.base_url` + version + '/links' go though `data` to find `attributes.base_url` (but note the last one is usually a backward link to https://providers.optimade.org)\n// 6. For these now go to `attributes.base_url` + version + '/structures'\n\n// but to start we will skip a few steps, and provide only some know final URLS\nconst StructureURLs = {\n  cod: 'https://www.crystallography.net/cod/optimade',\n  omdb: 'http://optimade.openmaterialsdb.se/',\n  tcod: 'https://www.crystallography.net/tcod/optimade',\n  oqmd: 'http://oqmd.org/optimade',\n  odbx: 'https://optimade.odbx.science'\n} as { [key: string]: string }\n\nexport const formulaPattern = new RegExp('^[\\\\sa-zA-Z0-9]+$')\n\nfunction appendUrl(url: string, tail: string): string {\n  return url.replace(/\\/$/, '') + '/' + tail.replace(/^\\//, '')\n}\n\n// A number of optimade providers do not supply the header `Access-Control-Allow-Origin $http_origin` in their responses\n// So we must go through a proxy (see https://javascript.info/fetch-crossorigin)\nfunction addCorsProxy(url: string, proxy = 'https://cors.optimade.org/'): string {\n  return appendUrl(proxy, url.replace(/^https?:\\/\\//, ''))\n}\n\nfunction getApiVersionPath(providers: Types.ProvidersResponse): string {\n  if (!providers.meta?.api_version) {\n    return ''\n  }\n  return `/v${providers.meta.api_version.charAt(0)}`\n}\n\nfunction providersResponse2Map(providers: Types.ProvidersResponse): Types.ProvidersMap {\n  return providers.data.reduce((prev, current) => {\n    prev[current.id] = current\n    return prev\n  }, {} as Types.ProvidersMap)\n}\n\nexport interface IStructureViewResponse {\n  data: {\n    type: string\n    id: string\n    attributes: {\n      dimension_types: [number, number, number]\n      lattice_vectors: [\n        [number, number, number],\n        [number, number, number],\n        [number, number, number]\n      ]\n      cartesian_site_positions: [number, number, number][]\n      species: {\n        name: string\n        chemical_symbols: string[]\n        concentration: number[]\n        mass?: number\n        original_name?: string\n      }[]\n      species_at_sites: string[]\n    }\n  }\n  links?: Types.Links\n  meta?: Types.Meta\n}\n\nexport class OptimadeClient {\n  // Class for interfacing with Optimade\n\n  private providers: Types.ProvidersResponse = defaultProviders\n  private versionPath: string\n\n  constructor(providers?: Types.ProvidersResponse) {\n    if (providers) {\n      this.providers = providers\n    }\n    this.versionPath = getApiVersionPath(this.providers)\n  }\n\n  async getStructureProviders(): Promise<Types.Provider[]> {\n    const providers = providersResponse2Map(this.providers)\n    return new Promise(function (resolve) {\n      resolve(Object.keys(StructureURLs).map(value => providers[value]))\n    })\n  }\n\n  async getStructures(\n    providerId?: string,\n    filterFormula: string | null = null,\n    exactFilter = false,\n    page = 1,\n    pageLimit = 10\n  ): Promise<{\n    structures: Types.Structure[]\n    url?: string\n    total?: number\n  }> {\n    // Note COD errors for a page limit greater than 10\n    if (!providerId) {\n      return { structures: [] }\n    }\n    const urlBase = addCorsProxy(StructureURLs[providerId]) // TODO if does not exist\n    const urlFull = appendUrl(appendUrl(urlBase, this.versionPath), '/structures')\n\n    // see https://github.com/Materials-Consortia/OPTIMADE/blob/master/optimade.rst#the-filter-language-syntax\n    let filter = ''\n    if (!filterFormula) {\n    } else if (!formulaPattern.test(filterFormula)) {\n      console.error(`Formula filter disallowed: ${filterFormula}`)\n    } else if (exactFilter) {\n      filter = `&filter=chemical_formula_descriptive%20=%20%22${filterFormula}%22`\n    } else {\n      filter = `&filter=chemical_formula_descriptive%20CONTAINS%20%22${filterFormula}%22`\n    }\n    const fields = 'last_modified,dimension_types,nsites,chemical_formula_descriptive'\n\n    const response = await fetch(\n      `${urlFull}?page_number=${page}&page_limit=${pageLimit}${filter}&sort=attributes.chemical_formula_descriptive&response_fields=${fields}`,\n      { headers: { origin: 'https://chrisjsewell.github.io/react-aiida-app' } } // required for the cors proxy\n    )\n    const responseJson = (await response.json()) as Types.StructuresResponse\n\n    return {\n      url: response.url,\n      structures: responseJson.data,\n      total: responseJson?.meta?.data_returned\n    }\n  }\n\n  /** Return single structure with attributes required for 3D rendering */\n  async getStructureView(\n    providerId: string,\n    structureId: string\n  ): Promise<{\n    data: IStructureViewResponse\n    url?: string\n  } | null> {\n    if (!providerId || !structureId) {\n      return null\n    }\n    const urlBase = addCorsProxy(StructureURLs[providerId]) // TODO if does not exist\n    const urlFull = appendUrl(\n      appendUrl(urlBase, this.versionPath),\n      `/structures/${structureId}`\n    )\n\n    const fields =\n      'dimension_types,lattice_vectors,cartesian_site_positions,species,species_at_sites'\n\n    const response = await fetch(\n      `${urlFull}?response_fields=${fields}`,\n      { headers: { origin: 'https://chrisjsewell.github.io/react-aiida-app' } } // required for the cors proxy\n    )\n    const responseJson = (await response.json()) as IStructureViewResponse\n\n    return {\n      url: response.url,\n      data: responseJson\n    }\n  }\n}\n\n// <link>/structures/<id>?response_fields=lattice_vectors,cartesian_site_positions,structure_features,species,species_at_sites\n\n// Copied from https://providers.optimade.org/providers.json\nconst defaultProviders = {\n  meta: {\n    api_version: '1.0.0',\n    query: {\n      representation: '/links'\n    },\n    more_data_available: false,\n    schema: 'https://schemas.optimade.org/openapi/v1.0/optimade_index.json',\n    data_returned: 0,\n    data_available: 0\n  },\n  data: [\n    {\n      type: 'links',\n      id: 'aiida',\n      attributes: {\n        name: 'AiiDA',\n        description:\n          'Automated Interactive Infrastructure and Database for Computational Science (AiiDA)',\n        base_url: null,\n        homepage: 'http://www.aiida.net',\n        link_type: 'external'\n      }\n    },\n    {\n      type: 'links',\n      id: 'aflow',\n      attributes: {\n        name: 'AFLOW',\n        description:\n          'Automatic FLOW (AFLOW) database for computational materials science',\n        base_url: 'https://providers.optimade.org/index-metadbs/aflow',\n        homepage: 'http://aflow.org',\n        link_type: 'external'\n      }\n    },\n    {\n      type: 'links',\n      id: 'cod',\n      attributes: {\n        name: 'Crystallography Open Database',\n        description:\n          'Open-access collection of crystal structures of organic, inorganic, metal-organics compounds and minerals, excluding biopolymers',\n        base_url: 'http://providers.optimade.org/index-metadbs/cod',\n        homepage: 'https://www.crystallography.net/cod',\n        link_type: 'external'\n      }\n    },\n    {\n      type: 'links',\n      id: 'exmpl',\n      attributes: {\n        name: 'Example provider',\n        description:\n          'Provider used for examples, not to be assigned to a real database',\n        base_url: 'http://providers.optimade.org/index-metadbs/exmpl',\n        homepage: 'https://example.com',\n        link_type: 'external'\n      }\n    },\n    {\n      type: 'links',\n      id: 'httk',\n      attributes: {\n        name: 'The High-Throughput Toolkit',\n        description:\n          'Prefix for implementation-specific identifiers used in the httk implementation at http://httk.org/',\n        base_url: null,\n        homepage: null,\n        link_type: 'external'\n      }\n    },\n    {\n      type: 'links',\n      id: 'matcloud',\n      attributes: {\n        name: 'MatCloud',\n        description:\n          'A high-throughput computing platform integrating data, simulation and supercomputing.',\n        base_url: 'https://providers.optimade.org/index-metadbs/matcloud',\n        homepage: 'http://matcloud.cnic.cn',\n        link_type: 'external'\n      }\n    },\n    {\n      type: 'links',\n      id: 'mcloud',\n      attributes: {\n        name: 'Materials Cloud',\n        description:\n          'A platform for Open Science built for seamless sharing of resources in computational materials science',\n        base_url: 'https://www.materialscloud.org/optimade',\n        homepage: 'https://www.materialscloud.org',\n        link_type: 'external'\n      }\n    },\n    {\n      type: 'links',\n      id: 'mp',\n      attributes: {\n        name: 'The Materials Project',\n        description:\n          'An open database of computed materials properties to accelerate materials discovery and design',\n        base_url: 'http://providers.optimade.org/index-metadbs/mp',\n        homepage: 'https://www.materialsproject.org',\n        link_type: 'external'\n      }\n    },\n    {\n      type: 'links',\n      id: 'mpds',\n      attributes: {\n        name: 'Materials Platform for Data Science',\n        description:\n          'A highly curated Pauling File dataset based on ~0.5M publications and backing up Springer Materials, ICDD PDF, ASM APD, MedeA, Pearson Crystal Data, AtomWork Advanced, etc.',\n        base_url: 'https://providers.optimade.org/index-metadbs/mpds',\n        homepage: 'https://mpds.io',\n        link_type: 'external'\n      }\n    },\n    {\n      type: 'links',\n      id: 'nmd',\n      attributes: {\n        name: 'novel materials discovery (NOMAD)',\n        description: 'A FAIR data sharing platform for materials science data',\n        base_url: 'https://nomad-lab.eu/prod/rae/optimade/index',\n        homepage: 'https://nomad-lab.eu',\n        link_type: 'external'\n      }\n    },\n    {\n      type: 'links',\n      id: 'odbx',\n      attributes: {\n        name: 'open database of xtals',\n        description:\n          'A public database of crystal structures mostly derived from ab initio structure prediction from the group of Dr Andrew Morris at the University of Birmingham https://ajm143.github.io',\n        base_url: 'https://optimade-index.odbx.science',\n        homepage: 'https://odbx.science',\n        link_type: 'external'\n      }\n    },\n    {\n      type: 'links',\n      id: 'omdb',\n      attributes: {\n        name: 'Open Materials Database',\n        description:\n          'The Open Materials Database (omdb) is a database of materials properties maintained by the developers of the High-Throughput Toolkit (httk). It enables easy access to useful materials data, in particular via programmatic interaction using this toolkit.',\n        base_url: 'https://optimade-index.openmaterialsdb.se',\n        homepage: 'http://openmaterialsdb.se',\n        link_type: 'external'\n      }\n    },\n    {\n      type: 'links',\n      id: 'optimade',\n      attributes: {\n        name: 'OPTIMADE implementations and libraries',\n        description:\n          'Prefix for implementation-specific identifiers used in API implementations and libraries provided at https://github.com/Materials-Consortia',\n        base_url: null,\n        homepage: 'https://www.optimade.org',\n        link_type: 'external'\n      }\n    },\n    {\n      type: 'links',\n      id: 'oqmd',\n      attributes: {\n        name: 'The Open Quantum Materials Database (OQMD)',\n        description:\n          'The OQMD is a database of DFT calculated thermodynamic and structural properties of materials',\n        base_url: 'http://providers.optimade.org/index-metadbs/oqmd',\n        homepage: 'http://oqmd.org',\n        link_type: 'external'\n      }\n    },\n    {\n      type: 'links',\n      id: 'jarvis',\n      attributes: {\n        name: 'Joint Automated Repository for Various Integrated Simulations (JARVIS)',\n        description:\n          'JARVIS is a repository designed to automate materials discovery using classical force-field, density functional theory, machine learning calculations and experiments.',\n        base_url: null,\n        homepage: 'https://jarvis.nist.gov',\n        link_type: 'external'\n      }\n    },\n    {\n      type: 'links',\n      id: 'pcod',\n      attributes: {\n        name: 'Predicted Crystallography Open Database',\n        description: '',\n        base_url: null,\n        homepage: null,\n        link_type: 'external'\n      }\n    },\n    {\n      type: 'links',\n      id: 'tcod',\n      attributes: {\n        name: 'Theoretical Crystallography Open Database',\n        description:\n          'Open-access collection of theoretically calculated or refined crystal structures of organic, inorganic, metal-organic compounds and minerals, excluding biopolymers',\n        base_url: 'http://providers.optimade.org/index-metadbs/tcod',\n        homepage: 'https://www.crystallography.net/tcod',\n        link_type: 'external'\n      }\n    }\n  ]\n} as Types.ProvidersResponse\n\nexport default OptimadeClient\n","import React, { useContext, useState, useRef } from 'react'\n\nimport {\n  Box,\n  Checkbox,\n  CircularProgress,\n  FormControl,\n  FormControlLabel,\n  Grid,\n  InputLabel,\n  MenuItem,\n  Select,\n  Slider,\n  Tabs,\n  Tab,\n  TextField,\n  Typography\n} from '@material-ui/core'\n\nimport { useQuery } from 'react-query'\nimport { ResizableBox, ResizeCallbackData } from 'react-resizable'\n\nimport { AiidaSettingsContext, getNode, uuidPattern } from '../clients/aiidaClient'\nimport { useLocalStorage } from '../hooks'\nimport { useStyles } from '../styles'\nimport { IStructureDataAttrs, vectorLength } from './structureUtils'\nimport { Structure3DViewer } from './structure3DViewer'\nimport { StructureTable } from './structureTable'\nimport OptimadeClient from '../clients/optimadeClient'\n\n/** Selector for a structure, plus visualisers */\nexport function StructurePanel({ initTab }: { initTab?: number }): JSX.Element {\n  const [tabIndex, setTabIndex] = React.useState(initTab || 0)\n\n  const handleChange = (event: React.ChangeEvent<any>, value: number) => {\n    setTabIndex(value)\n  }\n\n  return (\n    <React.Fragment>\n      <Tabs\n        value={tabIndex}\n        onChange={handleChange}\n        indicatorColor=\"primary\"\n        textColor=\"primary\"\n        variant=\"fullWidth\"\n        aria-label=\"full width tabs example\"\n      >\n        <Tab label=\"AiiDA\" />\n        <Tab label=\"Optimade\" />\n      </Tabs>\n      <TabPanel value={tabIndex} index={0}>\n        <StructurePanelAiiDA />\n      </TabPanel>\n      <TabPanel value={tabIndex} index={1}>\n        <StructurePanelOptimade />\n      </TabPanel>\n    </React.Fragment>\n  )\n}\n\ninterface TabPanelProps {\n  children?: React.ReactNode\n  index: any\n  value: any\n}\n\nfunction TabPanel(props: TabPanelProps) {\n  const { children, value, index, ...other } = props\n\n  return (\n    <div\n      role=\"tabpanel\"\n      hidden={value !== index}\n      id={`simple-tabpanel-${index}`}\n      aria-labelledby={`simple-tab-${index}`}\n      {...other}\n    >\n      {value === index && (\n        <Box p={3}>\n          <Typography>{children}</Typography>\n        </Box>\n      )}\n    </div>\n  )\n}\n\nexport function StructurePanelAiiDA(): JSX.Element {\n  const [rootUUID, setrootUUID] = useLocalStorage(\n    'aiida-structure-uuid',\n    null as null | string\n  )\n  const handleUUIDChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    setrootUUID(event.target.value)\n  }\n\n  const aiidaSettings = useContext(AiidaSettingsContext)\n\n  const result = useQuery(\n    [aiidaSettings.baseUrl, 'node', rootUUID],\n    () => getNode(aiidaSettings.baseUrl, rootUUID),\n    { enabled: aiidaSettings.baseUrl !== null }\n  )\n\n  let view = null as null | JSX.Element\n  let uuidErrorMessage: string | undefined = undefined\n  if (result.data) {\n    // check the data is actually StructureData\n    if (result.data.attributes.cell && result.data.attributes.sites) {\n      view = <StructurePanelBase node={result.data.attributes as IStructureDataAttrs} />\n    } else {\n      uuidErrorMessage = 'UUID is not a StructureData'\n    }\n  } else if (result.isLoading) {\n    view = <CircularProgress />\n  } else if (result.isError) {\n    uuidErrorMessage = `${result.error}`\n  }\n\n  return (\n    <React.Fragment>\n      <TextField\n        label=\"StructureData UUID\"\n        value={rootUUID || ''}\n        onChange={handleUUIDChange}\n        error={rootUUID ? !uuidPattern.test(rootUUID) || !!uuidErrorMessage : false}\n        helperText={uuidErrorMessage}\n        fullWidth\n        style={{ paddingBottom: 10 }}\n      />\n      {view}\n    </React.Fragment>\n  )\n}\n\nexport function StructurePanelOptimade(): JSX.Element {\n  const classes = useStyles()\n\n  const [provider, setProvider] = useLocalStorage('optimade-structure-provider', '')\n  const [id, setID] = useLocalStorage('optimade-structure-id', '')\n\n  const resultProviders = useQuery(['optimade', 'providers'], () =>\n    new OptimadeClient().getStructureProviders()\n  )\n  const resultStructure = useQuery(['optimade', 'structure', provider, id], () =>\n    new OptimadeClient().getStructureView(provider, id)\n  )\n\n  let providerItems = [] as JSX.Element[]\n  if (resultProviders.data) {\n    providerItems = resultProviders.data.map(value => (\n      <MenuItem key={value.id} value={value.id}>\n        {value.attributes.name}\n      </MenuItem>\n    ))\n  }\n\n  let view = null as null | JSX.Element\n  let uuidErrorMessage: string | undefined = undefined\n  if (resultStructure.data?.data) {\n    try {\n      const data = resultStructure.data.data.data\n      const pbc = data.attributes.dimension_types || [1, 1, 1]\n      const nodeData = {\n        cell: data.attributes.lattice_vectors,\n        pbc1: !!pbc[0],\n        pbc2: !!pbc[1],\n        pbc3: !!pbc[2],\n        sites: data.attributes.cartesian_site_positions.map((p, i) => {\n          return { position: p, kind_name: data.attributes.species_at_sites[i] }\n        }),\n        kinds: data.attributes.species.map(s => {\n          return {\n            name: s.name,\n            mass: s.mass || 0,\n            symbols: s.chemical_symbols,\n            weights: s.concentration\n          }\n        })\n      }\n      view = <StructurePanelBase node={nodeData as IStructureDataAttrs} />\n    } catch (err) {\n      uuidErrorMessage = `Structure parse failed: ${err}`\n    }\n  } else if (resultStructure.isLoading) {\n    view = <CircularProgress />\n  } else if (resultStructure.isError) {\n    uuidErrorMessage = `${resultStructure.error}`\n  }\n\n  return (\n    <React.Fragment>\n      <Grid container spacing={4} alignItems=\"center\">\n        <Grid item sm={6}>\n          <FormControl className={classes.formControl} fullWidth>\n            <InputLabel id=\"optimade-provider-view-select-label\">Provider</InputLabel>\n            <Select\n              id=\"optimade-provider-view-select\"\n              value={provider || ''}\n              onChange={(event: React.ChangeEvent<{ value: unknown | string }>) => {\n                setProvider(!event.target.value ? '' : (event.target.value as string))\n              }}\n            >\n              {providerItems}\n            </Select>\n          </FormControl>\n        </Grid>\n        <Grid item sm={6}>\n          <TextField\n            label=\"Structure ID\"\n            value={id}\n            onChange={(\n              event: React.ChangeEvent<HTMLTextAreaElement | HTMLInputElement>\n            ) => {\n              setID(event.target.value)\n            }}\n            error={!!uuidErrorMessage}\n            helperText={uuidErrorMessage}\n            fullWidth\n          />\n        </Grid>\n      </Grid>\n      {view}\n    </React.Fragment>\n  )\n}\n\nfunction StructurePanelBase({ node }: { node: IStructureDataAttrs }): JSX.Element {\n  // Structure viewer variables\n  const [boundingBox, setboundingBox] = useState(true)\n  const [aImages, setaImages] = useState(1)\n  const [bImages, setbImages] = useState(1)\n  const [cImages, setcImages] = useState(1)\n  const images = [] as [number, number, number][]\n  for (const an of Array.from(Array(aImages).keys())) {\n    for (const bn of Array.from(Array(bImages).keys())) {\n      for (const cn of Array.from(Array(cImages).keys())) {\n        images.push([an, bn, cn])\n      }\n    }\n  }\n\n  // TODO set the initial width to the width of the container (and change on window resize)\n  // possibly using useLayoutEffect, but how not to get into infinite feedback loop?\n  const [viewerSize, setviewerSize] = useState({ height: 200, width: 200 })\n  const viewerContainer = useRef() as any\n\n  const cell = node.cell\n\n  return (\n    <React.Fragment>\n      <Grid container spacing={4}>\n        <RepeatSlider name={'a'} value={aImages} setter={setaImages} />\n        <RepeatSlider name={'b'} value={bImages} setter={setbImages} />\n        <RepeatSlider name={'c'} value={cImages} setter={setcImages} />\n      </Grid>\n      <div style={{ marginTop: 10, marginBottom: undefined }} ref={viewerContainer}>\n        <ResizableBox\n          width={viewerSize.width}\n          height={viewerSize.height}\n          maxConstraints={[\n            viewerContainer?.current?.offsetWidth\n              ? viewerContainer.current.offsetWidth\n              : Infinity,\n            Infinity\n          ]}\n          resizeHandles={['s', 'e', 'se']}\n          onResize={(\n            e: React.SyntheticEvent<Element, Event>,\n            data: ResizeCallbackData\n          ) => {\n            setviewerSize({\n              width: data.size.width,\n              height: data.size.height\n            })\n          }}\n        >\n          <Structure3DViewer\n            data={node}\n            images={images}\n            withBox={boundingBox}\n            width={viewerSize.width}\n            height={viewerSize.height}\n          />\n        </ResizableBox>\n      </div>\n      <Grid container alignItems=\"center\">\n        <Grid item sm={6}>\n          <FormControlLabel\n            control={\n              <Checkbox\n                color=\"primary\"\n                checked={boundingBox}\n                onChange={(event: React.ChangeEvent<HTMLInputElement>) => {\n                  setboundingBox(event.target.checked)\n                }}\n              />\n            }\n            label=\"Bounding box\"\n            labelPlacement=\"end\"\n          />\n        </Grid>\n        <Grid item sm={6}>\n          <Typography align=\"right\">\n            A: {vectorLength(cell[0])}; B: {vectorLength(cell[1])}; C:{' '}\n            {vectorLength(cell[2])}\n          </Typography>\n        </Grid>\n      </Grid>\n      <StructureTable data={node} />\n    </React.Fragment>\n  )\n}\n\nfunction RepeatSlider(props: {\n  name: string\n  value: number\n  setter: any\n}): JSX.Element {\n  return (\n    <Grid item sm={4}>\n      <Typography>\n        repeat <i>{props.name}</i>\n      </Typography>\n      <Slider\n        defaultValue={props.value}\n        aria-labelledby=\"discrete-slider\"\n        valueLabelDisplay=\"auto\"\n        step={1}\n        marks\n        min={1}\n        max={10}\n        onChange={(event: React.ChangeEvent<unknown>, value: number | number[]) => {\n          props.setter(value as number)\n        }}\n      />\n    </Grid>\n  )\n}\n","import React, { useState } from 'react'\n\nimport {\n  Box,\n  Checkbox,\n  CircularProgress,\n  FormControl,\n  FormControlLabel,\n  Grid,\n  InputLabel,\n  MenuItem,\n  Select,\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableRow,\n  TextField,\n  Tooltip\n} from '@material-ui/core'\nimport { Launch } from '@material-ui/icons'\nimport { Alert, Pagination } from '@material-ui/lab'\n\nimport { useQuery } from 'react-query'\n\nimport { useStyles } from '../styles'\nimport OptimadeClient, { formulaPattern } from '../clients/optimadeClient'\nimport { Types } from 'optimade'\n\nexport function OptimadePanel(): JSX.Element {\n  const classes = useStyles()\n  const resultProviders = useQuery(['optimade', 'providers'], () =>\n    new OptimadeClient().getStructureProviders()\n  )\n\n  const [provider, setProvider] = useState(undefined as undefined | string)\n  const [formulaFilter, setformulaFilter] = useState(null as null | string)\n  const [exactFilter, setexactFilter] = useState(false)\n  const [page, setPage] = useState(1)\n  const pageLimit = 10\n  const resultStructures = useQuery(\n    ['optimade', 'structures', provider, formulaFilter, exactFilter, page],\n    () =>\n      new OptimadeClient().getStructures(\n        provider,\n        formulaFilter,\n        exactFilter,\n        page,\n        pageLimit\n      ),\n    { keepPreviousData: true }\n  )\n\n  let items = [] as JSX.Element[]\n  if (resultProviders.data) {\n    items = resultProviders.data.map(value => (\n      <MenuItem value={value.id}>\n        <Box display=\"flex\" alignItems=\"center\">\n          <Tooltip title={<p>{value.attributes.description}</p>}>\n            <span>{value.attributes.name} </span>\n          </Tooltip>\n          {value.attributes.homepage ? (\n            <a href={value.attributes.homepage} target=\"_blank\" rel=\"noopener\">\n              <Launch />\n            </a>\n          ) : null}\n        </Box>\n      </MenuItem>\n    ))\n  }\n\n  // Note: minHeight stops a scroll bar from appearing\n  let tableElement = (\n    <div style={{ minHeight: 100 }}>\n      <CircularProgress />\n    </div>\n  ) as undefined | JSX.Element\n  let pages = 1\n  if (resultStructures.data) {\n    pages = Math.ceil((resultStructures.data.total || pageLimit) / pageLimit)\n    if (!resultStructures.isPreviousData) {\n      tableElement = <OptimadeTable data={resultStructures.data.structures} />\n    }\n  } else if (resultStructures.isError) {\n    const error = resultStructures.error as { message: string }\n    tableElement = <Alert severity=\"error\">{error.message}</Alert>\n  }\n\n  return (\n    <Grid container alignItems=\"center\">\n      <Grid item xs={12}>\n        <FormControl className={classes.formControl} fullWidth>\n          <InputLabel id=\"optimade-provider-select-label\">Provider</InputLabel>\n          <Select\n            id=\"optimade-provider-select\"\n            value={provider || ''}\n            onChange={(event: React.ChangeEvent<{ value: unknown }>) => {\n              setProvider(event.target.value as string)\n              setPage(1)\n            }}\n          >\n            {items}\n          </Select>\n        </FormControl>\n      </Grid>\n      <Grid item sm={8}>\n        <TextField\n          label=\"Chemical Formula\"\n          value={formulaFilter || ''}\n          fullWidth\n          onChange={(event: React.ChangeEvent<HTMLInputElement>) => {\n            setformulaFilter(event.target.value)\n          }}\n          error={formulaFilter ? !formulaPattern.test(formulaFilter) : false}\n          helperText={\n            formulaFilter && !formulaPattern.test(formulaFilter)\n              ? 'Disallowed formula pattern'\n              : undefined\n          }\n          style={{ paddingBottom: 10 }}\n        />\n      </Grid>\n      <Grid item sm={4}>\n        <FormControlLabel\n          control={\n            <Checkbox\n              color=\"primary\"\n              checked={exactFilter}\n              onChange={(event: React.ChangeEvent<HTMLInputElement>) => {\n                setexactFilter(event.target.checked)\n              }}\n            />\n          }\n          label=\"Exact match\"\n          labelPlacement=\"start\"\n        />\n      </Grid>\n      <Grid item xs={12} className={classes.overflowAuto}>\n        <Pagination\n          disabled={resultStructures.isPreviousData}\n          className={classes.pagination}\n          color=\"primary\"\n          count={pages}\n          page={page}\n          onChange={(event: React.ChangeEvent<unknown>, value: number) => {\n            setPage(value)\n          }}\n        />\n        {tableElement}\n      </Grid>\n    </Grid>\n  )\n}\n\nexport function OptimadeTable({ data }: { data: Types.Structure[] }): JSX.Element {\n  return (\n    <Table className=\"optimade-table\">\n      <TableHead>\n        <TableRow key=\"_head\">\n          <TableCell>ID</TableCell>\n          <TableCell>Formula</TableCell>\n          <TableCell>Dimensions</TableCell>\n          <TableCell>Sites</TableCell>\n          <TableCell>Modified</TableCell>\n        </TableRow>\n      </TableHead>\n      <TableBody>\n        {(data || []).map(row => (\n          <TableRow key={row.id}>\n            <TableCell>{row.id}</TableCell>\n            <TableCell>{row.attributes?.chemical_formula_descriptive}</TableCell>\n            <TableCell>{row.attributes?.dimension_types}</TableCell>\n            <TableCell>{row.attributes?.nsites}</TableCell>\n            <TableCell>{row.attributes?.last_modified}</TableCell>\n          </TableRow>\n        ))}\n      </TableBody>\n    </Table>\n  )\n}\n","import React from 'react'\n\nimport {\n  Accordion,\n  AccordionDetails,\n  AccordionSummary,\n  Grid,\n  Paper\n} from '@material-ui/core'\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore'\n\nimport { Link } from 'react-router-dom'\n\nimport { useStyles } from './styles'\nimport PageKeys from './pages'\nimport { StructurePanel } from './components/structurePanel'\nimport { OptimadePanel } from './components/optimadePanel'\n\nexport function PageStructures(): JSX.Element {\n  const classes = useStyles()\n  return (\n    <Grid container spacing={2} className={classes.mainGrid} direction=\"row-reverse\">\n      <Grid item xs={12} sm={12} md={6}>\n        <Paper variant=\"outlined\" className={classes.paper}>\n          <Accordion defaultExpanded>\n            <AccordionSummary expandIcon={<ExpandMoreIcon />}>\n              <h3>Structure Visualisation</h3>\n            </AccordionSummary>\n            <AccordionDetails>\n              <div>\n                <p>\n                  This panel allows you to visualise structures within your database.\n                </p>\n                <p>\n                  Simply enter a <code>StructureData</code> UUID (you can copy one from\n                  the <Link to={PageKeys.nodeExplorer}>Node explorer</Link>). Then you\n                  can resize the viewer, zoom in/out, rotate (left-click) and pan\n                  (right-click).\n                </p>\n                <p>\n                  You can also search for and visualise structures from an{' '}\n                  <a href=\"https://www.optimade.org\" target=\"_blank\" rel=\"noopener\">\n                    Optimade compliant database\n                  </a>\n                  . It is intended that eventually you will be able to import these\n                  structures directly into your AiiDA database.\n                </p>\n              </div>\n            </AccordionDetails>\n          </Accordion>\n          <Accordion defaultExpanded>\n            <AccordionSummary expandIcon={<ExpandMoreIcon />}>\n              <h3>Optimade Explorer</h3>\n            </AccordionSummary>\n            <AccordionDetails>\n              <OptimadePanel />\n            </AccordionDetails>\n          </Accordion>\n        </Paper>\n      </Grid>\n\n      <Grid item xs={12} sm={12} md={6}>\n        <Paper variant=\"outlined\" className={classes.paper}>\n          <StructurePanel />\n        </Paper>\n      </Grid>\n    </Grid>\n  )\n}\n","import React from 'react'\nimport clsx from 'clsx'\n\nimport { useTheme } from '@material-ui/core/styles'\nimport AppBar from '@material-ui/core/AppBar'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport Typography from '@material-ui/core/Typography'\nimport TextField from '@material-ui/core/TextField'\nimport IconButton from '@material-ui/core/IconButton'\nimport Drawer from '@material-ui/core/Drawer'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport Divider from '@material-ui/core/Divider'\nimport * as MuiIcons from '@material-ui/icons'\nimport { Omit } from '@material-ui/types'\n\nimport {\n  Switch,\n  Route,\n  Link as RouterLink,\n  LinkProps as RouterLinkProps,\n  Redirect,\n  useLocation\n} from 'react-router-dom'\nimport { QueryClientProvider, useQuery } from 'react-query'\nimport { ReactQueryDevtools } from 'react-query/devtools'\n\nimport {\n  AiidaSettingsContext,\n  defaultRestUrl,\n  isConnected,\n  queryAiidaClient,\n  urlPattern\n} from './clients/aiidaClient'\nimport { useStyles } from './styles'\nimport { AiiDAIcon200, GitBranchIcon, OptimadeIcon } from './icons'\nimport PageKeys from './pages'\nimport { PageHome } from './PageHome'\nimport { PageNodeExplorer } from './PageNodeExplorer'\nimport { PageProvenanceGraph } from './PageProvenanceGraph'\nimport { PageStructures } from './PageStructures'\nimport { useLocalStorage } from './hooks'\n\ninterface ListItemLinkProps {\n  icon?: React.ReactElement\n  primary: string\n  to: string\n}\n\nfunction ListItemLink(props: ListItemLinkProps) {\n  const { icon, primary, to } = props\n  const location = useLocation()\n\n  const renderLink = React.useMemo(\n    () =>\n      React.forwardRef<any, Omit<RouterLinkProps, 'to'>>((itemProps, ref) => (\n        <RouterLink to={to} ref={ref} {...itemProps} />\n      )),\n    [to]\n  )\n\n  return (\n    <li>\n      <ListItem button component={renderLink} selected={to === location.pathname}>\n        {icon ? <ListItemIcon>{icon}</ListItemIcon> : null}\n        <ListItemText primary={primary} />\n      </ListItem>\n    </li>\n  )\n}\n\nexport function App({ showDevTools = true }: { showDevTools?: boolean }): JSX.Element {\n  // style hooks\n  const classes = useStyles()\n  const theme = useTheme()\n\n  // component state for the left menu\n  const [drawerOpen, setDrawerOpen] = React.useState(false)\n  const handleDrawerOpen = () => {\n    setDrawerOpen(true)\n  }\n  const handleDrawerClose = () => {\n    setDrawerOpen(false)\n  }\n\n  // component state for the AiiDA REST URL\n  // the URL is is stored, so that it persists between sessions and page refreshes\n  // we also validate to only allow http/https schema, and no ? which start the query string\n  // TODO better URL validation (to guard against attacks)\n  const [restUrlBase, setRestUrlBase] = useLocalStorage(\n    'react-aiida-rest-url',\n    defaultRestUrl\n  )\n  const handleUrlChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    setRestUrlBase(event.target.value)\n  }\n\n  return (\n    <div className={classes.root}>\n      <QueryClientProvider client={queryAiidaClient}>\n        <AppBar\n          position=\"sticky\"\n          className={clsx(classes.appBar, {\n            [classes.appBarShift]: drawerOpen\n          })}\n        >\n          <Toolbar>\n            <IconButton\n              edge=\"start\"\n              onClick={handleDrawerOpen}\n              className={clsx(classes.menuButton, {\n                [classes.hide]: drawerOpen\n              })}\n              color=\"inherit\"\n              aria-label=\"open drawer\"\n            >\n              <MuiIcons.Menu />\n            </IconButton>\n            <Typography variant=\"h6\" className={classes.title} id=\"app-header\">\n              AiiDA Dashboard\n            </Typography>\n            {/* TODO periodically update connection status */}\n            <RestUrlConnection\n              url={urlPattern.test(restUrlBase) ? restUrlBase : null}\n              className={classes.inputRestUrlIcon}\n            />\n            <TextField\n              id=\"rest-url\"\n              className={classes.inputRestUrl}\n              label=\"REST URL\"\n              value={restUrlBase}\n              error={!urlPattern.test(restUrlBase)}\n              helperText={urlPattern.test(restUrlBase) ? undefined : 'Invalid URL'}\n              onChange={handleUrlChange}\n              autoComplete={defaultRestUrl}\n              InputProps={{\n                className: classes.inputRestUrlText\n              }}\n            />\n            <AiiDAIcon200 width={40} height={40} />\n          </Toolbar>\n        </AppBar>\n\n        <Drawer\n          variant=\"permanent\"\n          className={clsx(classes.drawer, {\n            [classes.drawerOpen]: drawerOpen,\n            [classes.drawerClose]: !drawerOpen\n          })}\n          classes={{\n            paper: clsx({\n              [classes.drawerOpen]: drawerOpen,\n              [classes.drawerClose]: !drawerOpen\n            })\n          }}\n        >\n          <div className={classes.toolbar}>\n            <IconButton onClick={handleDrawerClose}>\n              {theme.direction === 'rtl' ? (\n                <MuiIcons.ChevronRight />\n              ) : (\n                <MuiIcons.ChevronLeft />\n              )}\n            </IconButton>\n          </div>\n          <Divider />\n\n          <List>\n            <ListItemLink to={PageKeys.home} primary=\"Home\" icon={<MuiIcons.Home />} />\n            <ListItemLink\n              to={PageKeys.nodeExplorer}\n              primary=\"Node Explorer\"\n              icon={<MuiIcons.Explore />}\n            />\n            <ListItemLink\n              to={PageKeys.provenanceGraph}\n              primary=\"Provenance Graph\"\n              icon={<GitBranchIcon />}\n            />\n            <ListItemLink\n              to={PageKeys.structures}\n              primary=\"Structure Explorer\"\n              icon={<OptimadeIcon />}\n            />\n          </List>\n        </Drawer>\n\n        <AiidaSettingsContext.Provider\n          value={{ baseUrl: urlPattern.test(restUrlBase) ? restUrlBase : null }}\n        >\n          <Switch>\n            <Route exact path={PageKeys.home} component={PageHome} />\n            <Route path={PageKeys.nodeExplorer} component={PageNodeExplorer} />\n            <Route path={PageKeys.provenanceGraph} component={PageProvenanceGraph} />\n            <Route path={PageKeys.structures} component={PageStructures} />\n            <Route path={PageKeys.unknown} component={NotFound} />\n            <Redirect to={PageKeys.unknown} />\n          </Switch>\n        </AiidaSettingsContext.Provider>\n\n        {showDevTools ? <ReactQueryDevtools initialIsOpen={false} /> : null}\n      </QueryClientProvider>\n    </div>\n  )\n}\n\nfunction NotFound(): JSX.Element {\n  // TODO Offset\n  return (\n    <div>\n      <h1>404 - Not Found!</h1>\n      <RouterLink to=\"/\">Go Home</RouterLink>\n    </div>\n  )\n}\n\nfunction RestUrlConnection({\n  url,\n  className = undefined\n}: {\n  url: string | null\n  className?: string\n}): JSX.Element {\n  const result = useQuery([url, 'connected'], () => isConnected(url))\n  // TODO hover over info/error?\n  if (result.data) {\n    return <MuiIcons.CheckCircle className={className} />\n  }\n  return <MuiIcons.Cancel color=\"error\" className={className} />\n}\n\nexport default App\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport reportWebVitals from './reportWebVitals'\nimport { HashRouter } from 'react-router-dom'\nimport { App } from './App'\n\nimport './index.css'\nimport './reactResizable.css'\n\nReactDOM.render(\n  <React.StrictMode>\n    <HashRouter>\n      <App />\n    </HashRouter>\n  </React.StrictMode>,\n  document.getElementById('root')\n)\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals()\n"],"sourceRoot":""}